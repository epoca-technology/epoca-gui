<!-- Section Container -->
<mat-drawer-container class="section-container">

    <!-- Main Sidenav -->
    <mat-drawer #predBacktestingSidenav [(opened)]="predBacktestingSidenavOpened" *ngIf="initialized"
                class="sidenav" position="start" mode="over" autoFocus="false">
        <!-- Menu Heading Toolbar -->
        <mat-toolbar color="primary">
            <div fxLayout="row" fxLayoutAlign="start center">
                <button mat-icon-button (click)="predBacktestingSidenav?.toggle()"><mat-icon>arrow_back</mat-icon></button>
                <span>Backtests</span>
                <span fxFlex></span>
            </div>
        </mat-toolbar>

        <!-- Menu Content -->
        <mat-list>
            <div mat-subheader>General</div>
            <mat-list-item *ngFor="let sect of generalSections">
                <button mat-button class="left-icon-button" [disabled]="section.id == sect.id" (click)="activateSection(sect)">
                    <mat-icon>{{sect.icon}}</mat-icon> {{sect.name}}
                </button>
            </mat-list-item>
            <div mat-subheader>
                Models&nbsp;
                <mat-icon *ngIf="order == 'points'" class="order-icon" matTooltip="Ordered by points collected">query_stats</mat-icon>
                <mat-icon *ngIf="order == 'point_medians'" class="order-icon" matTooltip="Ordered by the median of points collected.">vertical_align_center</mat-icon>
                <mat-icon *ngIf="order == 'acc'" class="order-icon" matTooltip="Ordered by accuracy">ads_click</mat-icon>
            </div>
            <mat-list-item *ngFor="let id of _backtest.modelIDs">
                <button mat-button class="left-icon-button truncate" 
                        [disabled]="section.id == 'model' && modelID == id" 
                        (click)="activateSection({id: 'model', name: id}, id)">
                        <div fxLayout="row" fxLayoutAlign="start center">
                            <span class="truncate" style="max-width:80%">{{id | stringOverview: 10}}</span>
                            <span fxFlex></span>
                            <div *ngIf="order == 'points'" 
                                [ngClass]="{
                                    'square-badge': _backtest.performances[id].points == 0,
                                    'square-badge-success': _backtest.performances[id].points > 0,
                                    'square-badge-error': _backtest.performances[id].points < 0
                                }"><span>{{_backtest.performances[id].points | number:'1.2-2'}}</span></div>
                            <div *ngIf="order == 'point_medians'" 
                                [ngClass]="{
                                    'square-badge': _backtest.performances[id].points_median == 0,
                                    'square-badge-success': _backtest.performances[id].points_median > 0,
                                    'square-badge-error': _backtest.performances[id].points_median < 0
                                }"><span>{{_backtest.performances[id].points_median | number:'1.2-2'}}</span></div>
                            <div *ngIf="order == 'acc'" class="square-badge">
                                <span>{{_backtest.performances[id].general_acc | number:'1.2-2'}}%</span>
                            </div>
                        </div>
                </button>
            </mat-list-item>
        </mat-list>
    </mat-drawer>


    <!-- Section Content -->
    <mat-drawer-content id="content-header">
        <!-- Content Header -->
        <mat-toolbar class="secondary-header">
            <div fxLayout="row" fxLayoutAlign="center center">
                <button mat-icon-button (click)="_nav.dashboard()" class="show-on-mobile" *ngIf="!initialized"><mat-icon>arrow_back</mat-icon></button>
                <button mat-icon-button (click)="resetResults()" class="show-on-mobile" *ngIf="initialized"><mat-icon>arrow_back</mat-icon></button>
                <button mat-icon-button (click)="predBacktestingSidenav?.toggle()" *ngIf="initialized" class="show-on-mobile"><mat-icon>menu</mat-icon></button>
                <span class="truncate show-on-mobile" *ngIf="!initialized">Backtests</span>
                <span class="truncate show-on-mobile" *ngIf="initialized">{{section.id == 'model' ? modelID: section.name}}</span>
                <span class="truncate show-on-desktop">Backtests</span>
                <span fxFlex></span>
                <button mat-icon-button 
                        matTooltip="Selected Models" 
                        *ngIf="initialized && _backtest.modelIDs.length > 1" 
                        [disabled]="!_selection.selectedList.length"
                        (click)="_nav.displayModelSelectionDialog()">
                        <mat-icon 
                            [matBadge]="_selection.selectedList.length > 9 ? '9+': _selection.selectedList.length" 
                            matBadgeSize="small"
                            matBadgePosition="after"
                            matBadgeOverlap="false">checklist</mat-icon>
                </button>
                <button mat-icon-button 
                        matTooltip="Clear Backtest Results"
                        (click)="resetResults()"
                        class="show-on-desktop"
                        *ngIf="initialized"><mat-icon>close</mat-icon></button>
            </div>
        </mat-toolbar>



        <!-- Uninitialized Content -->
        <div *ngIf="!initialized" class="fadeIn">
            <div fxLayout="row" fxLayoutAlign="center center" class="file-init-container">
                <!-- Button -->
                <label for="backtestFile" class="file-label" role="button" matRipple *ngIf="!initializing">
                    <div fxLayout="row" fxLayoutAlign="start center" matRipple role="button" tabindex="0">
                        <mat-icon svgIcon="file_waveform"></mat-icon>&nbsp;
                        <p>Select Backtest Files</p>
                    </div>
                </label>

                <!-- Input -->
                <form [formGroup]="fileInputForm">
                    <input id="backtestFile" type="file" accept="application/json" 
                            formControlName="fileInput" (change)="fileChanged($event)" multiple/>
                </form>

                <!-- Initializing Loader-->
                <h3 *ngIf="initializing" class="fadeIn">Initializing...</h3>
            </div>
        </div>



        <!-- Initialized Content -->
        <div *ngIf="initialized" class="fadeIn">
            <div fxLayout="row">
                <div *ngIf="layout == 'desktop'" class="desktop-sidenav">
                    <mat-list>
                        <div mat-subheader>General</div>
                        <mat-list-item *ngFor="let sect of generalSections">
                            <button mat-button class="left-icon-button" [disabled]="section.id == sect.id" (click)="activateSection(sect)">
                                <mat-icon>{{sect.icon}}</mat-icon> {{sect.name}}
                            </button>
                        </mat-list-item>
                        <div mat-subheader>
                            Models&nbsp;
                            <mat-icon *ngIf="order == 'points'" class="order-icon" matTooltip="Ordered by points collected">query_stats</mat-icon>
                            <mat-icon *ngIf="order == 'point_medians'" class="order-icon" matTooltip="Ordered by the median of points collected.">vertical_align_center</mat-icon>
                            <mat-icon *ngIf="order == 'acc'" class="order-icon" matTooltip="Ordered by accuracy">ads_click</mat-icon>
                        </div>
                        <mat-list-item *ngFor="let id of _backtest.modelIDs">
                            <button mat-button class="left-icon-button truncate" 
                                    [disabled]="section.id == 'model' && modelID == id" 
                                    (click)="activateModel(id)">
                                    <div fxLayout="row" fxLayoutAlign="start center">
                                        <span class="truncate" style="max-width:80%">{{id | stringOverview: 10}}</span>
                                        <span fxFlex></span>
                                        <div *ngIf="order == 'points'" 
                                            [ngClass]="{
                                                'square-badge': _backtest.performances[id].points == 0,
                                                'square-badge-success': _backtest.performances[id].points > 0,
                                                'square-badge-error': _backtest.performances[id].points < 0
                                            }"><span>{{_backtest.performances[id].points | number:'1.2-2'}}</span></div>
                                        <div *ngIf="order == 'point_medians'" 
                                            [ngClass]="{
                                                'square-badge': _backtest.performances[id].points_median == 0,
                                                'square-badge-success': _backtest.performances[id].points_median > 0,
                                                'square-badge-error': _backtest.performances[id].points_median < 0
                                            }"><span>{{_backtest.performances[id].points_median | number:'1.2-2'}}</span></div>
                                        <div *ngIf="order == 'acc'" class="square-badge">
                                            <span>{{_backtest.performances[id].general_acc | number:'1.2-2'}}%</span>
                                        </div>
                                    </div>
                            </button>
                        </mat-list-item>
                    </mat-list>
                </div>
                <div fxFlex>
                    <!-- Loader -->
                    <div *ngIf="!loaded" class="loader">
                        <div fxLayout="row" fxLayoutAlign="center center"><mat-spinner diameter="50"></mat-spinner></div>
                    </div>

                    <!-- Sections -->
                    <div *ngIf="loaded">

                        <!-- General Sections -->
                        <div *ngIf="section.id != 'model'" fxLayout="row" fxLayoutAlign="center center" class="general-sections">

                            <!-- Points Section -->
                            <div *ngIf="section.id == 'points' && pointsDistChart && pointsLineChart" fxFlex="90" fxFlex.xs="100" fxflex.sm="100">
                                <!-- Distribution -->
                                <div class="desktop-card">
                                    <div fxLayout="row" fxLayoutAlign="center center">
                                        <h4 class="show-on-desktop">Points Accumulated</h4>
                                        <span class="show-on-desktop" fxFlex></span>
                                        <div class="square-badge-success clickable" role="button"
                                            (click)="activateModel(_backtest.pointsMD.max.id)" 
                                            matTooltip="{{_backtest.pointsMD.max.id}}">
                                            Best: {{_backtest.pointsMD.max.value}}
                                        </div>
                                        <div class="square-badge-error clickable" role="button" 
                                            (click)="activateModel(_backtest.pointsMD.min.id)" 
                                            matTooltip="{{_backtest.pointsMD.min.id}}">
                                            Worst: {{_backtest.pointsMD.min.value}}
                                        </div>
                                    </div>
                                    <div>
                                        <apx-chart
                                            [series]="pointsDistChart.series"
                                            [chart]="pointsDistChart.chart"
                                            [plotOptions]="pointsDistChart.plotOptions"
                                            [xaxis]="pointsDistChart.xaxis"
                                            [dataLabels]="pointsDistChart.dataLabels"
                                            [colors]="pointsDistChart.colors"
                                            [grid]="pointsDistChart.grid"
                                            [legend]="{show: false}"
                                        ></apx-chart>
                                    </div>
                                </div>

                                <div *ngIf="_backtest.modelIDs.length <= 40" class="divider show-on-mobile"></div>

                                <!-- Lines - Only if there 40 models or less -->
                                <div *ngIf="_backtest.modelIDs.length <= 40" class="desktop-card">
                                    <div fxLayout="row" fxLayoutAlign="center center">
                                        <h4 class="show-on-desktop">Points Accumulation History</h4>
                                        <span class="show-on-desktop" fxFlex></span>
                                        <div class="square-badge-success clickable" role="button"
                                            (click)="activateModel(_backtest.pointsHistoryMD.max.id)" 
                                            matTooltip="{{_backtest.pointsHistoryMD.max.id}}">
                                            High: {{_backtest.pointsHistoryMD.max.value}}
                                        </div>
                                        <div class="square-badge-error clickable" role="button"
                                            (click)="activateModel(_backtest.pointsHistoryMD.min.id)" 
                                            matTooltip="{{_backtest.pointsHistoryMD.min.id}}">
                                            Low: {{_backtest.pointsHistoryMD.min.value}}
                                        </div>
                                    </div>
                                    <div>
                                        <apx-chart
                                            [series]="pointsLineChart.series"
                                            [chart]="pointsLineChart.chart"
                                            [xaxis]="pointsLineChart.xaxis"
                                            [dataLabels]="pointsLineChart.dataLabels"
                                            [grid]="pointsLineChart.grid"
                                            [stroke]="pointsLineChart.stroke"
                                            [yaxis]="pointsLineChart.yaxis"
                                        ></apx-chart>
                                    </div>
                                </div>
                            </div>

                            <div *ngIf="section.id != 'points'" fxFlex="65" fxFlex.xs="100" fxflex.sm="100">
                                <!-- Points Median -->
                                <div *ngIf="section.id == 'points_median' && pointsMedianChart">
                                    <div class="desktop-card">
                                        <div fxLayout="row" fxLayoutAlign="center center">
                                            <h4 class="show-on-desktop">Point Medians</h4>
                                            <span class="show-on-desktop" fxFlex></span>
                                            <div class="square-badge-success clickable" role="button" 
                                                matTooltip="Best Points Median: {{_backtest.pointsMedianMD.max.id}}"
                                                (click)="activateModel(_backtest.pointsMedianMD.max.id)">
                                                Best: {{_backtest.pointsMedianMD.max.value | number:'1.0-2'}}
                                            </div>
                                            <div class="square-badge-error clickable" role="button" 
                                                matTooltip="Worst Points Median: {{_backtest.pointsMedianMD.min.id}}"
                                                (click)="activateModel(_backtest.pointsMedianMD.min.id)">
                                                Worst: {{_backtest.pointsMedianMD.min.value | number:'1.0-2'}}
                                            </div>
                                        </div>
                                        <div>
                                            <apx-chart
                                                [series]="pointsMedianChart.series"
                                                [chart]="pointsMedianChart.chart"
                                                [plotOptions]="pointsMedianChart.plotOptions"
                                                [xaxis]="pointsMedianChart.xaxis"
                                                [dataLabels]="pointsMedianChart.dataLabels"
                                                [colors]="pointsMedianChart.colors"
                                                [grid]="pointsMedianChart.grid"
                                                [legend]="{show: false}"
                                            ></apx-chart>
                                        </div>
                                    </div>
                                </div>

                                <!-- Accuracy Section -->
                                <div *ngIf="section.id == 'accuracy' && accuracyChart">
                                    <div class="desktop-card">
                                        <div fxLayout="row" fxLayoutAlign="center center">
                                            <h4 class="show-on-desktop">Accuracy</h4>
                                            <span class="show-on-desktop" fxFlex></span>
                                            <button mat-icon-button 
                                                    [disabled]="viewBest" 
                                                    (click)="viewBest = true">
                                                    <mat-icon>arrow_left</mat-icon>
                                            </button>
                                            <div *ngIf="viewBest" class="fadeIn" fxLayout="row" fxLayoutAlign="center center">
                                                <div class="square-badge-success clickable" role="button" 
                                                    matTooltip="Best Long Accuracy: {{_backtest.accuracyMD.long.max.id}}"
                                                    (click)="activateModel(_backtest.accuracyMD.long.max.id)">
                                                    {{_backtest.accuracyMD.long.max.value}}%
                                                </div>
                                                <div class="square-badge-error clickable" role="button" 
                                                    matTooltip="Best Short Accuracy: {{_backtest.accuracyMD.short.max.id}}"
                                                    (click)="activateModel(_backtest.accuracyMD.short.max.id)">
                                                    {{_backtest.accuracyMD.short.max.value}}%
                                                </div>
                                                <div class="square-badge clickable" role="button" 
                                                    matTooltip="Best General Accuracy: {{_backtest.accuracyMD.general.max.id}}"
                                                    (click)="activateModel(_backtest.accuracyMD.general.max.id)">
                                                    {{_backtest.accuracyMD.general.max.value}}%
                                                </div>
                                            </div>
                                            <div *ngIf="!viewBest" class="fadeIn" fxLayout="row" fxLayoutAlign="center center">
                                                <div class="square-badge-success clickable" role="button" 
                                                    matTooltip="Worst Long Accuracy: {{_backtest.accuracyMD.long.min.id}}"
                                                    (click)="activateModel(_backtest.accuracyMD.long.min.id)">
                                                    {{_backtest.accuracyMD.long.min.value}}%
                                                </div>
                                                <div class="square-badge-error clickable" role="button" 
                                                    matTooltip="Worst Short Accuracy: {{_backtest.accuracyMD.short.min.id}}"
                                                    (click)="activateModel(_backtest.accuracyMD.short.min.id)">
                                                    {{_backtest.accuracyMD.short.min.value}}%
                                                </div>
                                                <div class="square-badge clickable" role="button" 
                                                    matTooltip="Worst General Accuracy: {{_backtest.accuracyMD.general.min.id}}"
                                                    (click)="activateModel(_backtest.accuracyMD.general.min.id)">
                                                    {{_backtest.accuracyMD.general.min.value}}%
                                                </div>
                                            </div>
                                            <button mat-icon-button 
                                                    [disabled]="!viewBest" 
                                                    (click)="viewBest = false">
                                                    <mat-icon>arrow_right</mat-icon>
                                            </button>
                                        </div>
                                        <div>
                                            <apx-chart
                                                [series]="accuracyChart.series"
                                                [chart]="accuracyChart.chart"
                                                [plotOptions]="accuracyChart.plotOptions"
                                                [xaxis]="accuracyChart.xaxis"
                                                [dataLabels]="accuracyChart.dataLabels"
                                                [colors]="accuracyChart.colors"
                                                [grid]="accuracyChart.grid"
                                                [legend]="{position: 'top'}"
                                            ></apx-chart>
                                        </div>
                                    </div>
                                </div>


                                <!-- Positions Section -->
                                <div *ngIf="section.id == 'positions' && positionsChart">
                                    <div class="desktop-card">
                                        <div fxLayout="row" fxLayoutAlign="center center">
                                            <h4 class="show-on-desktop">Positions</h4>
                                            <span class="show-on-desktop" fxFlex></span>
                                            <button mat-icon-button 
                                                    [disabled]="viewBest" 
                                                    (click)="viewBest = true">
                                                    <mat-icon>arrow_left</mat-icon>
                                            </button>
                                            <div *ngIf="viewBest" class="fadeIn" fxLayout="row" fxLayoutAlign="center center">
                                                <div class="square-badge-success clickable" role="button" 
                                                    matTooltip="Highest # of Longs: {{_backtest.positionsMD.long.max.id}}"
                                                    (click)="activateModel(_backtest.positionsMD.long.max.id)">
                                                    {{_backtest.positionsMD.long.max.value}}
                                                </div>
                                                <div class="square-badge-error clickable" role="button" 
                                                    matTooltip="Highest # of Shorts: {{_backtest.positionsMD.short.max.id}}"
                                                    (click)="activateModel(_backtest.positionsMD.short.max.id)">
                                                    {{_backtest.positionsMD.short.max.value}}
                                                </div>
                                                <div class="square-badge clickable" role="button" 
                                                    matTooltip="Highest # of Positions: {{_backtest.positionsMD.general.max.id}}"
                                                    (click)="activateModel(_backtest.positionsMD.general.max.id)">
                                                    {{_backtest.positionsMD.general.max.value}}
                                                </div>
                                            </div>
                                            <div *ngIf="!viewBest" class="fadeIn" fxLayout="row" fxLayoutAlign="center center">
                                                <div class="square-badge-success clickable" role="button" 
                                                    matTooltip="Lowest # of Longs: {{_backtest.positionsMD.long.min.id}}"
                                                    (click)="activateModel(_backtest.positionsMD.long.min.id)">
                                                    {{_backtest.positionsMD.long.min.value}}
                                                </div>
                                                <div class="square-badge-error clickable" role="button" 
                                                    matTooltip="Lowest # of Shorts: {{_backtest.positionsMD.short.min.id}}"
                                                    (click)="activateModel(_backtest.positionsMD.short.min.id)">
                                                    {{_backtest.positionsMD.short.min.value}}
                                                </div>
                                                <div class="square-badge clickable" role="button" 
                                                    matTooltip="Lowest # of Positions: {{_backtest.positionsMD.general.min.id}}"
                                                    (click)="activateModel(_backtest.positionsMD.general.min.id)">
                                                    {{_backtest.positionsMD.general.min.value}}
                                                </div>
                                            </div>
                                            <button mat-icon-button 
                                                    [disabled]="!viewBest" 
                                                    (click)="viewBest = false">
                                                    <mat-icon>arrow_right</mat-icon>
                                            </button>
                                        </div>
                                        <div>
                                            <apx-chart
                                                [series]="positionsChart.series"
                                                [chart]="positionsChart.chart"
                                                [plotOptions]="positionsChart.plotOptions"
                                                [xaxis]="positionsChart.xaxis"
                                                [dataLabels]="positionsChart.dataLabels"
                                                [colors]="positionsChart.colors"
                                                [grid]="positionsChart.grid"
                                                [legend]="{position: 'top'}"
                                            ></apx-chart>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Model Sections -->
                        <div *ngIf="section.id == 'model' && modelID">
                            <!-- Tabs Navigation-->
                            <mat-tab-group *ngIf="layout == 'mobile'" 
                                        [selectedIndex]="activeIndex" (selectedIndexChange)="activeIndex = $event"
                                        class="mat-elevation-z3" mat-stretch-tabs mat-align-tabs="center" backgroundColor="primary">
                                <mat-tab label="Summary"></mat-tab>
                                <mat-tab label="Positions"></mat-tab>
                            </mat-tab-group>
                            <mat-tab-group *ngIf="layout == 'desktop'"  
                                            [selectedIndex]="activeIndex" (selectedIndexChange)="activeIndex = $event" 
                                            mat-align-tabs="center">
                                <mat-tab label="Summary"></mat-tab>
                                <mat-tab label="Positions"></mat-tab>
                            </mat-tab-group>

                            <!-- Content -->
                            <div class="padding">
                                <!-- Summary Section -->
                                <div *ngIf="activeIndex == 0" class="summary-section">
                                    <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column">
                                        <!-- Summary Cards-->
                                        <div fxFlex="40" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
                                            <!-- Backtest -->
                                            <div class="desktop-card">
                                                <!-- Heading -->
                                                <div fxLayout="row" fxLayoutAlign="start center">
                                                    <h4>Backtest</h4>
                                                    <span fxFlex></span>
                                                    <button mat-icon-button 
                                                            matTooltip="Copy Backtest Summary" 
                                                            (click)="copyBacktestSummary()"><mat-icon>receipt_long</mat-icon></button>
                                                </div>

                                                <!-- Description -->
                                                <p class="light-text">{{_backtest.backtests[modelID].description}}</p>

                                                <!-- Backtest ID -->
                                                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                    <p class="light-text truncate">Backtest ID</p>
                                                    <span fxFlex></span>
                                                    <p>{{_backtest.backtests[modelID].id}}</p>
                                                </div>

                                                <!-- Start Date -->
                                                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                    <p class="light-text truncate">Start</p>
                                                    <span fxFlex></span>
                                                    <p matTooltip="The Open Time of the first candlestick used for the test.">
                                                        {{_backtest.backtests[modelID].start | date:'medium'}}
                                                    </p>
                                                </div>

                                                <!-- End Date -->
                                                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                    <p class="light-text truncate">End</p>
                                                    <span fxFlex></span>
                                                    <p matTooltip="The Close Time of the last candlestick used for the test.">
                                                        {{_backtest.backtests[modelID].end | date:'medium'}}
                                                    </p>
                                                </div>

                                               <!-- Position Exit Percentages -->
                                               <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                    <p class="light-text truncate">Position Exit</p>
                                                    <span fxFlex></span>
                                                    <p class="success-color" matTooltip="Take Profit">{{_backtest.backtests[modelID].take_profit}}%</p>
                                                    <p>&nbsp;/&nbsp;</p>
                                                    <p class="error-color" matTooltip="Stop Loss">{{_backtest.backtests[modelID].stop_loss}}%</p>
                                                </div>

                                                <!-- Idle Minutes -->
                                                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                     <p class="light-text truncate">Idle Minutes</p>
                                                     <span fxFlex></span>
                                                     <p matTooltip="The number of minutes the model remained idle every time it closed a position.">
                                                         {{_backtest.backtests[modelID].idle_minutes_on_position_close}} mins
                                                    </p>
                                                </div>
                                            </div>

                                            <div class="divider"></div>

                                            <!-- Model -->
                                            <div class="desktop-card">
                                                <app-model-content [model]="_backtest.models[modelID]" [displayHeader]="true"></app-model-content>
                                            </div>

                                            <div class="divider"></div>

                                            <!-- Accuracy -->
                                            <div class="desktop-card">
                                                <div fxLayout="row" fxLayoutAlign="start center">
                                                    <h4 class="show-on-desktop">Accuracy</h4>
                                                    <h4 class="show-on-mobile">Acc.</h4>
                                                    <span fxFlex></span>
                                                    <div class="square-badge-success">{{_backtest.performances[modelID].long_acc}}%</div>
                                                    <div class="square-badge-error">{{_backtest.performances[modelID].short_acc}}%</div>
                                                    <div class="square-badge">{{_backtest.performances[modelID].general_acc}}%</div>
                                                </div>
                                                <apx-chart
                                                    [series]="modelCharts[modelID].accuracy.series"
                                                    [chart]="modelCharts[modelID].accuracy.chart"
                                                    [plotOptions]="modelCharts[modelID].accuracy.plotOptions"
                                                    [xaxis]="modelCharts[modelID].accuracy.xaxis"
                                                    [yaxis]="modelCharts[modelID].accuracy.yaxis"
                                                    [dataLabels]="modelCharts[modelID].accuracy.dataLabels"
                                                    [colors]="modelCharts[modelID].accuracy.colors"
                                                    [grid]="modelCharts[modelID].accuracy.grid"
                                                ></apx-chart>
                                            </div>
                                        </div>

                                        <span fxFlex></span>

                                        <!-- Chart Cards-->
                                        <div fxFlex="57" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
                                            <!-- Divider for mobile-->
                                            <div class="divider"></div>

                                            <!-- Points -->
                                            <div class="desktop-card points-card">
                                                <div fxLayout="row" fxLayoutAlign="start center">
                                                    <h4>Points</h4>
                                                    <span fxFlex></span>
                                                    <div class="square-badge">Median: {{_backtest.performances[modelID].points_median | number:'1.0-2'}}</div>
                                                    <div class="square-badge">Final: {{_backtest.performances[modelID].points | number:'1.0-2'}}</div>
                                                </div>
                                                <div class="points-chart">
                                                    <apx-chart
                                                        [series]="modelCharts[modelID].points.series"
                                                        [chart]="modelCharts[modelID].points.chart"
                                                        [plotOptions]="modelCharts[modelID].points.plotOptions"
                                                        [xaxis]="modelCharts[modelID].points.xaxis"
                                                        [dataLabels]="modelCharts[modelID].points.dataLabels"
                                                        [colors]="modelCharts[modelID].points.colors"
                                                        [grid]="modelCharts[modelID].points.grid"
                                                        [legend]="{show: false}"
                                                        [yaxis]="modelCharts[modelID].points.yaxis"
                                                    ></apx-chart>
                                                </div>
                                            </div>
                                            <div class="divider"></div>

                                            <!-- Positions & Outcomes -->
                                            <div class="positions-and-outcomes">
                                                <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">
                                                    <!-- Positions -->
                                                    <div fxFlex="49">
                                                        <div class="desktop-card">
                                                            <div fxLayout="row" fxLayoutAlign="start center">
                                                                <h4 class="show-on-desktop">Positions</h4>
                                                                <h4 class="show-on-mobile">Pos.</h4>
                                                                <span fxFlex></span>
                                                                <div class="square-badge-success">{{_backtest.performances[modelID].long_num}}</div>
                                                                <div class="square-badge-error">{{_backtest.performances[modelID].short_num}}</div>
                                                                <div class="square-badge">{{_backtest.performances[modelID].positions.length}}</div>
                                                            </div>
                                                            <apx-chart
                                                                [series]="modelCharts[modelID].positions.series"
                                                                [chart]="modelCharts[modelID].positions.chart"
                                                                [labels]="modelCharts[modelID].positions.labels"
                                                                [colors]="modelCharts[modelID].positions.colors"
                                                                [legend]="modelCharts[modelID].positions.legend"
                                                                [responsive]="modelCharts[modelID].positions.responsive"
                                                            ></apx-chart>
                                                        </div>
                                                    </div>
                                                    <span fxFlex></span>
                                                    <div class="divider"></div>
                                                    
                                                    <!-- Outcomes -->
                                                    <div fxFlex="49">
                                                        <div class="desktop-card">
                                                            <div fxLayout="row" fxLayoutAlign="start center">
                                                                <h4 class="show-on-desktop">Outcomes</h4>
                                                                <h4 class="show-on-mobile">Out.</h4>
                                                                <span fxFlex></span>
                                                                <div class="square-badge-success">{{_backtest.performances[modelID].long_outcome_num}}</div>
                                                                <div class="square-badge-error">{{_backtest.performances[modelID].short_outcome_num}}</div>
                                                                <div class="square-badge">{{_backtest.performances[modelID].positions.length}}</div>
                                                            </div>
                                                            <apx-chart
                                                                [series]="modelCharts[modelID].outcomes.series"
                                                                [chart]="modelCharts[modelID].outcomes.chart"
                                                                [labels]="modelCharts[modelID].outcomes.labels"
                                                                [colors]="modelCharts[modelID].outcomes.colors"
                                                                [legend]="modelCharts[modelID].outcomes.legend"
                                                                [responsive]="modelCharts[modelID].outcomes.responsive"
                                                            ></apx-chart>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <!-- Positions Section-->
                                <div *ngIf="activeIndex == 1" class="fadeIn">
                                    <div fxLayout="row" fxLayoutAlign="center center">
                                        <div fxFlex="60" fxFlex.xs="100" fxFlex.sm="100">
                                            <!-- Positions Table -->
                                            <div class="desktop-card positions">
                                                <table class="bordered highlight">
                                                    <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Open</th>
                                                            <th *ngIf="layout == 'desktop'">Close</th>
                                                            <th>Type</th>
                                                            <th>Points</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngFor="let p of _backtest.performances[modelID].positions; let i = index" 
                                                            (click)="displayPosition(p)" class="clickable" role="button">
                                                            <td *ngIf="(i+1) <= visiblePositions">
                                                                <p class="light-text">{{i+1}}</p>
                                                            </td>
                                                            <td *ngIf="(i+1) <= visiblePositions">
                                                                <p class="show-on-mobile">{{p.ot | date:'short'}}</p>
                                                                <p class="show-on-desktop">{{p.ot | date:'medium'}}</p>
                                                            </td>
                                                            <td *ngIf="(i+1) <= visiblePositions && layout == 'desktop'">
                                                                <p>{{p.ct | date:'medium'}}</p>
                                                            </td>
                                                            <td *ngIf="(i+1) <= visiblePositions">
                                                                <p [ngClass]="{'success-color': p.t == 1, 'error-color': p.t == -1}">
                                                                    {{p.t == 1 ? 'Long': 'Short'}}
                                                                </p>
                                                            </td>
                                                            <td *ngIf="(i+1) <= visiblePositions" class="align-right">
                                                                <p [ngClass]="{'success-color': p.o, 'error-color': !p.o}">
                                                                    <strong>{{p.pts}}</strong>
                                                                </p>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                            <!-- Paginator -->
                                            <div *ngIf="visiblePositions <= _backtest.performances[modelID].positions.length" class="paginator">
                                                <button mat-button (click)="visiblePositions=visiblePositions+15">View More</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>



                            <!-- Model Selection Fab -->
                            <div *ngIf="!_selection.selected[modelID] && _backtest.modelIDs.length > 1" class="model-selection-fab">
                                <button mat-fab color="primary" class="show-on-desktop" matTooltip="Select Model"
                                    (click)="_selection.select(modelID, _backtest.performances[modelID].points)">
                                    <mat-icon>add_task</mat-icon>
                                </button>
                                <button mat-mini-fab color="primary" class="show-on-mobile" matTooltip="Select Model"
                                    (click)="_selection.select(modelID, _backtest.performances[modelID].points)">
                                    <mat-icon>add_task</mat-icon>
                                </button>
                            </div>
                            <div *ngIf="_selection.selected[modelID] && _backtest.modelIDs.length > 1" class="model-selection-fab">
                                <button mat-fab color="warn" class="show-on-desktop" matTooltip="Unselect Model" 
                                    (click)="_selection.unselect(modelID)">
                                    <mat-icon>remove</mat-icon>
                                </button>
                                <button mat-mini-fab color="warn" class="show-on-mobile" matTooltip="Unselect Model"
                                     (click)="_selection.unselect(modelID)">
                                    <mat-icon>remove</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </mat-drawer-content>
</mat-drawer-container>