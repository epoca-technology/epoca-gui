<!-- Section Container -->
<mat-drawer-container class="section-container">

    <!-- Main Sidenav -->
    <mat-drawer #positionSidenav [(opened)]="positionSidenavOpened" class="sidenav" position="start" mode="over" autoFocus="false">
        <!-- Menu Heading Toolbar -->
        <mat-toolbar color="primary">
            <div fxLayout="row" fxLayoutAlign="start center">
                <button mat-icon-button (click)="positionSidenav?.toggle()"><mat-icon>arrow_back</mat-icon></button>
                <span class="truncate clickable" (click)="displayPredictionModel()">
                    {{epoch ? epoch.id + ' Positions': 'Positions'}}
                </span>
                <span fxFlex></span>
            </div>
        </mat-toolbar>

        <!-- Menu Content -->
        <mat-list>
            <mat-list-item *ngFor="let item of sections">
                <button mat-button class="left-icon-button" 
                        (click)="activateSection(item.id)" 
                        [disabled]="activeSection.id == item.id">
                    <mat-icon *ngIf="item.svgIcon" [svgIcon]="item.svgIcon"></mat-icon>
                    <mat-icon *ngIf="item.icon">{{item.icon}}</mat-icon>
                    <span>{{item.name}}</span>
                </button>
            </mat-list-item>
        </mat-list>
    </mat-drawer>


    <!-- Section Content -->
    <mat-drawer-content>
        <div>
            <!-- Section Header -->
            <mat-toolbar class="secondary-header">
                <div fxLayout="row" fxLayoutAlign="center center">
                    <button mat-icon-button (click)="positionSidenav?.toggle()" class="show-on-mobile"><mat-icon>menu</mat-icon></button>
                    <span class="truncate">{{epoch ? activeSection.name: 'Positions'}}</span>
                    <span fxFlex></span>

                    <!-- Close Epoch-->
                    <button mat-icon-button 
                            *ngIf="epoch && loaded && sectionLoaded"
                            matTooltip="Close {{epoch.id}}"
                            (click)="initializeEpochData()"><mat-icon>close</mat-icon></button>
                </div>
            </mat-toolbar>



            <!-- Section Content -->
            <div [ngClass]="{'section-content': layout == 'mobile'}">
                <!-- Initialization Loader -->
                <div *ngIf="!initialized && initializing" class="section-loader">
                    <div fxLayout="row" fxLayoutAlign="center center"><mat-spinner diameter="50"></mat-spinner></div>
                </div>

                <!-- Epoch Menu -->
                <div *ngIf="initialized && !epoch" fxLayout="row" fxLayoutAlign="center center" class="padding">
                    <div fxFlex="30" fxFlex.xs="100" fxFlex.sm="100">
                        <app-epochs-menu (epochID)="initializeEpochData($event)"></app-epochs-menu>
                    </div>
                </div>

                <!-- Prediction Container -->
                <div *ngIf="initialized && epoch">
                    <!-- Loader -->
                    <div *ngIf="!loaded" class="section-loader">
                        <div fxLayout="row" fxLayoutAlign="center center"><mat-spinner diameter="50"></mat-spinner></div>
                    </div>

                    <!-- No trades in range-->
                    <p *ngIf="loaded && !_d.positions.length" class="light-text align-center margin-top-x3 fadeIn">No positions were found</p>

                    <!-- Prediction Candlesticks -->
                    <div *ngIf="loaded && _d.positions.length" class="fadeIn">
                        <div fxLayout="row">
                            <!-- Desktop Sidenav -->
                            <div *ngIf="layout == 'desktop'" class="desktop-sidenav">
                                <mat-list>
                                    <div mat-subheader class="truncate clickable" (click)="displayPredictionModel()">
                                        {{epoch ? epoch.id + ' Positions': 'Positions'}}
                                    </div>
                                    <mat-list-item *ngFor="let item of sections">
                                        <button mat-button 
                                                class="left-icon-button" 
                                                (click)="activateSection(item.id)" [disabled]="activeSection.id == item.id">
                                            <mat-icon *ngIf="item.svgIcon" [svgIcon]="item.svgIcon"></mat-icon>
                                            <mat-icon *ngIf="item.icon">{{item.icon}}</mat-icon>
                                            <span>{{item.name}}</span>
                                        </button>
                                    </mat-list-item>
                                </mat-list>
                            </div>

                            <!-- Content -->
                            <div fxFlex>
                                <!-- Loader -->
                                <div *ngIf="!sectionLoaded" class="loader">
                                    <div fxLayout="row" fxLayoutAlign="center center"><mat-spinner diameter="50"></mat-spinner></div>
                                </div>

                                <!-- Section Content -->
                                <div *ngIf="sectionLoaded" class="fadeIn">

                                    <!-- Summary -->
                                    <div *ngIf="activeSection.id == 'summary' && summary" class="padding">
                                        <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">
                                            <!-- PNL History, Position Trades & PNL -->
                                            <div fxFlex="49" fxFlex.xs="100" fxFlex.sm="100">

                                                <!-- PNL History -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="start start" class="chart-header">
                                                        <div>
                                                            <h4>PNL History</h4>
                                                            <p class="light-text ts-xs">
                                                                {{_d.start | date: 'MMMM d'}} - {{_d.end | date: 'MMMM d'}}
                                                            </p>
                                                        </div>
                                                        <span fxFlex></span>
                                                        <div [ngClass]="{
                                                                'square-badge-neutral': _d.pnl.lastAccum == 0,
                                                                'square-badge-success': _d.pnl.lastAccum > 0,
                                                                'square-badge-error': _d.pnl.lastAccum < 0
                                                            }" 
                                                            class="clickable" role="button" matRipple
                                                            (click)="displayDataItems([_d.pnl, _d.longPNL, _d.shortPNL])" 
                                                            matTooltip="Realized PNL">
                                                        {{_d.pnl.lastAccum > 0 ? '+':''}}{{_d.pnl.lastAccum | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="summary.pnlHist.series"
                                                            [chart]="summary.pnlHist.chart"
                                                            [dataLabels]="summary.pnlHist.dataLabels"
                                                            [xaxis]="summary.pnlHist.xaxis"
                                                            [yaxis]="summary.pnlHist.yaxis"
                                                            [stroke]="summary.pnlHist.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>

                                                <div class="divider show-on-mobile"></div>

                                                <!-- Positions & PNL -->
                                                <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">

                                                    <!-- Position -->
                                                    <div fxFlex="48">
                                                        <div class="desktop-card no-margin">
                                                            <!-- Header -->
                                                            <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                                <h4>Positions</h4>
                                                                <span fxFlex></span>
                                                                <div class="square-badge" matTooltip="Total Positions">
                                                                    {{_d.longPositions + _d.shortPositions | number}}
                                                                </div>
                                                            </div>
        
                                                            <!-- Chart -->
                                                            <div class="chart">
                                                                <apx-chart
                                                                    [series]="summary.positions.series"
                                                                    [chart]="summary.positions.chart"
                                                                    [plotOptions]="summary.positions.plotOptions"
                                                                    [xaxis]="summary.positions.xaxis"
                                                                    [yaxis]="summary.positions.yaxis"
                                                                    [dataLabels]="summary.positions.dataLabels"
                                                                    [colors]="summary.positions.colors"
                                                                    [grid]="summary.positions.grid"
                                                                    [legend]="{position: 'bottom'}"
                                                                ></apx-chart>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="divider show-on-mobile"></div>
                                                    <span fxFlex></span>

                                                    <!-- PNL -->
                                                    <div fxFlex="48">
                                                        <div class="desktop-card no-margin">
                                                            <!-- Header -->
                                                            <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                                <h4>PNL</h4>
                                                                <span fxFlex></span>
                                                                <div class="square-badge-success margin-right clickable" role="button" matRipple
                                                                    matTooltip="Long PNL"
                                                                    (click)="displayDataItems([_d.longPNL])" >
                                                                    {{_d.longPNL.lastAccum > 0 ? '+': ''}}{{_d.longPNL.lastAccum | currency}}
                                                                </div>
                                                                <div class="square-badge-error clickable" 
                                                                    matTooltip="Short PNL" role="button" matRipple
                                                                    (click)="displayDataItems([_d.shortPNL])">
                                                                    {{_d.shortPNL.lastAccum > 0 ? '+': ''}}{{_d.shortPNL.lastAccum | currency}}
                                                                </div>
                                                            </div>
        
                                                            <!-- Chart -->
                                                            <div class="chart">
                                                                <apx-chart
                                                                    [series]="summary.pnl.series"
                                                                    [chart]="summary.pnl.chart"
                                                                    [plotOptions]="summary.pnl.plotOptions"
                                                                    [xaxis]="summary.pnl.xaxis"
                                                                    [yaxis]="summary.pnl.yaxis"
                                                                    [dataLabels]="summary.pnl.dataLabels"
                                                                    [colors]="summary.pnl.colors"
                                                                    [grid]="summary.pnl.grid"
                                                                    [legend]="{position: 'bottom'}"
                                                                ></apx-chart>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="divider show-on-mobile"></div>
                                            <span fxFlex></span>

                                            <!-- General Info -->
                                            <div fxFlex="49" fxFlex.xs="100" fxFlex.sm="100">

                                                <!-- Bottom Line & Fees -->
                                                <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">

                                                    <!-- Bottom Line -->
                                                    <div fxFlex="48" fxFlex.xs="100" fxFlex.sm="100">
                                                        <div class="desktop-card">
                                                            <!-- Header -->
                                                            <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                                <h4>Bottom Line</h4>
                                                                <span fxFlex></span>
                                                                <div [ngClass]="{
                                                                    'square-badge-neutral': _d.netProfit == 0,
                                                                    'square-badge-success': _d.netProfit > 0,
                                                                    'square-badge-error': _d.netProfit < 0
                                                                }" matTooltip="Net Profit">
                                                                    {{_d.netProfit > 0 ? '+':''}}{{_d.netProfit | currency}}
                                                                </div>
                                                            </div>
        
                                                            <!-- Chart -->
                                                            <div class="chart">
                                                                <apx-chart
                                                                    [series]="summary.bottomLine.series"
                                                                    [chart]="summary.bottomLine.chart"
                                                                    [plotOptions]="summary.bottomLine.plotOptions"
                                                                    [xaxis]="summary.bottomLine.xaxis"
                                                                    [yaxis]="summary.bottomLine.yaxis"
                                                                    [dataLabels]="summary.bottomLine.dataLabels"
                                                                    [colors]="summary.bottomLine.colors"
                                                                    [grid]="summary.bottomLine.grid"
                                                                    [legend]="{show: true, position: 'bottom'}"
                                                                ></apx-chart>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="divider show-on-mobile"></div>
                                                    <span fxFlex></span>


                                                    <!-- Fees -->
                                                    <div fxFlex="48" fxFlex.xs="100" fxFlex.sm="100">
                                                        <div class="desktop-card">
                                                            <!-- Header -->
                                                            <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                                <h4>Fees</h4>
                                                                <span fxFlex></span>
                                                                <div class="square-badge clickable" role="button" matRipple
                                                                    matTooltip="Total Fees"
                                                                    (click)="displayDataItems([_d.fees, _d.longFees, _d.shortFees])">
                                                                    {{_d.feesTotal | currency}}
                                                                </div>
                                                            </div>
        
                                                            <!-- Chart -->
                                                            <div class="chart">
                                                                <apx-chart
                                                                    [series]="summary.fees.series"
                                                                    [chart]="summary.fees.chart"
                                                                    [plotOptions]="summary.fees.plotOptions"
                                                                    [xaxis]="summary.fees.xaxis"
                                                                    [yaxis]="summary.fees.yaxis"
                                                                    [dataLabels]="summary.fees.dataLabels"
                                                                    [colors]="summary.fees.colors"
                                                                    [grid]="summary.fees.grid"
                                                                    [legend]="{show: true, position: 'bottom'}"
                                                                ></apx-chart>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="divider show-on-mobile"></div>

                                               
                                                <!-- Amounts & Prices -->
                                                <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">

                                                    <!-- Amounts -->
                                                    <div fxFlex="48" fxFlex.xs="100" fxFlex.sm="100">
                                                        <div class="desktop-card no-margin">
                                                            <!-- Header -->
                                                            <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                                <h4>Amounts</h4>
                                                                <span fxFlex></span>
                                                                <div class="square-badge clickable" role="button" matRipple
                                                                    matTooltip="Total amount traded"
                                                                    (click)="displayDataItems([_d.amounts, _d.longAmounts, _d.shortAmounts])">
                                                                    {{_d.amounts.lastAccum| currency}}
                                                                </div>
                                                            </div>
        
                                                            <!-- Chart -->
                                                            <div class="chart">
                                                                <apx-chart
                                                                    [series]="summary.amounts.series"
                                                                    [chart]="summary.amounts.chart"
                                                                    [plotOptions]="summary.amounts.plotOptions"
                                                                    [xaxis]="summary.amounts.xaxis"
                                                                    [yaxis]="summary.amounts.yaxis"
                                                                    [dataLabels]="summary.amounts.dataLabels"
                                                                    [colors]="summary.amounts.colors"
                                                                    [grid]="summary.amounts.grid"
                                                                    [legend]="{show: true, position: 'bottom'}"
                                                                ></apx-chart>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="divider show-on-mobile"></div>
                                                    <span fxFlex></span>


                                                    <!-- Prices -->
                                                    <div fxFlex="48" fxFlex.xs="100" fxFlex.sm="100">
                                                        <div class="desktop-card no-margin">
                                                            <!-- Header -->
                                                            <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                                <h4>Prices</h4>
                                                                <span fxFlex></span>
                                                                <div class="square-badge clickable" role="button" matRipple
                                                                     matTooltip="The mean of all the prices" 
                                                                     (click)="displayDataItems([_d.prices, _d.longPrices, _d.shortPrices])">
                                                                    ~{{_d.prices.mean | currency}}
                                                                </div>
                                                            </div>
        
                                                            <!-- Chart -->
                                                            <div class="chart">
                                                                <apx-chart
                                                                    [series]="summary.prices.series"
                                                                    [chart]="summary.prices.chart"
                                                                    [plotOptions]="summary.prices.plotOptions"
                                                                    [xaxis]="summary.prices.xaxis"
                                                                    [yaxis]="summary.prices.yaxis"
                                                                    [dataLabels]="summary.prices.dataLabels"
                                                                    [colors]="summary.prices.colors"
                                                                    [grid]="summary.prices.grid"
                                                                    [legend]="{show: true, position: 'bottom'}"
                                                                ></apx-chart>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- PNL -->
                                    <div *ngIf="activeSection.id == 'pnl' && pnl" class="padding">
                                        <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">
                                            <span fxFlex></span>
                                            <!-- Long PNL -->
                                            <div fxFlex="45" fxFlex.xs="100" fxFlex.sm="100">
                                                <!-- Long Accum -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Long Accum. PNL</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-success clickable" role="button" matRipple 
                                                            matTooltip="Long PNL Accumulated" 
                                                            (click)="displayDataItems([_d.longPNL])">
                                                            {{_d.longPNL.lastAccum > 0 ? '+':''}}{{_d.longPNL.lastAccum | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="pnl.longAccum.series"
                                                            [chart]="pnl.longAccum.chart"
                                                            [dataLabels]="pnl.longAccum.dataLabels"
                                                            [xaxis]="pnl.longAccum.xaxis"
                                                            [yaxis]="pnl.longAccum.yaxis"
                                                            [stroke]="pnl.longAccum.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>

                                                <div class="divider show-on-mobile"></div>

                                                <!-- Long -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Long PNL</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-success clickable" role="button" matRipple 
                                                            matTooltip="Long PNL"
                                                            (click)="displayDataItems([_d.longPNL])">
                                                            Mean: {{_d.longPNL.mean | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="pnl.long.series"
                                                            [chart]="pnl.long.chart"
                                                            [dataLabels]="pnl.long.dataLabels"
                                                            [xaxis]="pnl.long.xaxis"
                                                            [yaxis]="pnl.long.yaxis"
                                                            [stroke]="pnl.long.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="divider show-on-mobile"></div>
                                            <span fxFlex></span>


                                            <!-- Short PNL -->
                                            <div fxFlex="45" fxFlex.xs="100" fxFlex.sm="100">
                                                <!-- Short Accum -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Short Accum. PNL</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-error clickable" role="button" matRipple  
                                                            matTooltip="Short PNL Accumulated"
                                                            (click)="displayDataItems([_d.shortPNL])">
                                                            {{_d.shortPNL.lastAccum > 0 ? '+':''}}{{_d.shortPNL.lastAccum | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="pnl.shortAccum.series"
                                                            [chart]="pnl.shortAccum.chart"
                                                            [dataLabels]="pnl.shortAccum.dataLabels"
                                                            [xaxis]="pnl.shortAccum.xaxis"
                                                            [yaxis]="pnl.shortAccum.yaxis"
                                                            [stroke]="pnl.shortAccum.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>

                                                <div class="divider show-on-mobile"></div>

                                                <!-- Short -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Short PNL</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-error clickable" role="button" matRipple  
                                                            matTooltip="Short PNL"
                                                            (click)="displayDataItems([_d.shortPNL])">
                                                            Mean: {{_d.shortPNL.mean | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="pnl.short.series"
                                                            [chart]="pnl.short.chart"
                                                            [dataLabels]="pnl.short.dataLabels"
                                                            [xaxis]="pnl.short.xaxis"
                                                            [yaxis]="pnl.short.yaxis"
                                                            [stroke]="pnl.short.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>
                                            </div>
                                            <span fxFlex></span>
                                        </div>
                                    </div>

                                    <!-- Fees -->
                                    <div *ngIf="activeSection.id == 'fees' && fees" class="padding">
                                        <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">
                                            <span fxFlex></span>
                                            <!-- Long Fees -->
                                            <div fxFlex="45" fxFlex.xs="100" fxFlex.sm="100">
                                                <!-- Long Accum -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Long Accum. Fees</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-success clickable" role="button" matRipple  
                                                            matTooltip="Long Fees Accumulated"
                                                            (click)="displayDataItems([_d.longFees])">
                                                            {{_d.longFees.lastAccum | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="fees.longAccum.series"
                                                            [chart]="fees.longAccum.chart"
                                                            [dataLabels]="fees.longAccum.dataLabels"
                                                            [xaxis]="fees.longAccum.xaxis"
                                                            [yaxis]="fees.longAccum.yaxis"
                                                            [stroke]="fees.longAccum.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>

                                                <div class="divider show-on-mobile"></div>

                                                <!-- Long -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Long Fees</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-success clickable" role="button" matRipple
                                                             matTooltip="Long Fees Mean"
                                                             (click)="displayDataItems([_d.longFees])">
                                                            Mean: {{_d.longFees.mean | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="fees.long.series"
                                                            [chart]="fees.long.chart"
                                                            [dataLabels]="fees.long.dataLabels"
                                                            [xaxis]="fees.long.xaxis"
                                                            [yaxis]="fees.long.yaxis"
                                                            [stroke]="fees.long.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="divider show-on-mobile"></div>
                                            <span fxFlex></span>


                                            <!-- Short Fees -->
                                            <div fxFlex="45" fxFlex.xs="100" fxFlex.sm="100">
                                                <!-- Short Accum -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Short Accum. Fees</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-error clickable" role="button" matRipple
                                                            matTooltip="Short Fees Accumulated"
                                                            (click)="displayDataItems([_d.shortFees])">
                                                            {{_d.shortFees.lastAccum | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="fees.shortAccum.series"
                                                            [chart]="fees.shortAccum.chart"
                                                            [dataLabels]="fees.shortAccum.dataLabels"
                                                            [xaxis]="fees.shortAccum.xaxis"
                                                            [yaxis]="fees.shortAccum.yaxis"
                                                            [stroke]="fees.shortAccum.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>

                                                <div class="divider show-on-mobile"></div>

                                                <!-- Short -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Short Fees</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-error clickable" role="button" matRipple
                                                            matTooltip="Short Fees Mean"
                                                            (click)="displayDataItems([_d.shortFees])">
                                                            Mean: {{_d.shortFees.mean | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="fees.short.series"
                                                            [chart]="fees.short.chart"
                                                            [dataLabels]="fees.short.dataLabels"
                                                            [xaxis]="fees.short.xaxis"
                                                            [yaxis]="fees.short.yaxis"
                                                            [stroke]="fees.short.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>
                                            </div>
                                            <span fxFlex></span>
                                        </div>
                                    </div>

                                    <!-- Amounts -->
                                    <div *ngIf="activeSection.id == 'amounts' && amounts" class="padding">
                                        <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">
                                            <span fxFlex></span>
                                            <!-- Long Increase -->
                                            <div fxFlex="45" fxFlex.xs="100" fxFlex.sm="100">
                                                <!-- Long Accum -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Long Accum.</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-success clickable"  role="button" matRipple
                                                            matTooltip="Long Amounts Accum."
                                                            (click)="displayDataItems([_d.longAmounts])">
                                                            {{_d.longAmounts.lastAccum | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="amounts.longAccum.series"
                                                            [chart]="amounts.longAccum.chart"
                                                            [dataLabels]="amounts.longAccum.dataLabels"
                                                            [xaxis]="amounts.longAccum.xaxis"
                                                            [yaxis]="amounts.longAccum.yaxis"
                                                            [stroke]="amounts.longAccum.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>

                                                <div class="divider show-on-mobile"></div>

                                                <!-- Long Increase -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Long Increase</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-success clickable"  role="button" matRipple
                                                            matTooltip="Long Increase Amounts Mean"
                                                            (click)="displayDataItems([_d.longAmounts])">
                                                            Mean: {{_d.longAmounts.mean | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="amounts.long.series"
                                                            [chart]="amounts.long.chart"
                                                            [dataLabels]="amounts.long.dataLabels"
                                                            [xaxis]="amounts.long.xaxis"
                                                            [yaxis]="amounts.long.yaxis"
                                                            [stroke]="amounts.long.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="divider show-on-mobile"></div>
                                            <span fxFlex></span>


                                            <!-- Short Amounts -->
                                            <div fxFlex="45" fxFlex.xs="100" fxFlex.sm="100">
                                                <!-- Short Accum -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Short Accum.</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-error clickable" role="button" matRipple
                                                            matTooltip="Short Amounts Accum."
                                                            (click)="displayDataItems([_d.shortAmounts])">
                                                            {{_d.shortAmounts.lastAccum | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="amounts.shortAccum.series"
                                                            [chart]="amounts.shortAccum.chart"
                                                            [dataLabels]="amounts.shortAccum.dataLabels"
                                                            [xaxis]="amounts.shortAccum.xaxis"
                                                            [yaxis]="amounts.shortAccum.yaxis"
                                                            [stroke]="amounts.shortAccum.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>

                                                <div class="divider show-on-mobile"></div>

                                                <!-- Short Increase -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Short Increase</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-error clickable" role="button" matRipple
                                                            matTooltip="Short Increase Amounts Mean"
                                                            (click)="displayDataItems([_d.shortAmounts])">
                                                            Mean: {{_d.shortAmounts.mean | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="amounts.short.series"
                                                            [chart]="amounts.short.chart"
                                                            [dataLabels]="amounts.short.dataLabels"
                                                            [xaxis]="amounts.short.xaxis"
                                                            [yaxis]="amounts.short.yaxis"
                                                            [stroke]="amounts.short.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>
                                            </div>
                                            <span fxFlex></span>
                                        </div>
                                    </div>

                                    <!-- Prices -->
                                    <div *ngIf="activeSection.id == 'prices' && prices" class="padding">
                                        <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">
                                            <span fxFlex></span>
                                            <!-- Long -->
                                            <div fxFlex="45" fxFlex.xs="100" fxFlex.sm="100">
                                                <!-- Long Prices -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Long Prices</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-success clickable" role="button" matRipple
                                                            matTooltip="Long Price Mean"
                                                            (click)="displayDataItems([_d.longPrices])">
                                                            Mean: {{_d.longPrices.mean | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="prices.long.series"
                                                            [chart]="prices.long.chart"
                                                            [dataLabels]="prices.long.dataLabels"
                                                            [xaxis]="prices.long.xaxis"
                                                            [yaxis]="prices.long.yaxis"
                                                            [stroke]="prices.long.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="divider show-on-mobile"></div>
                                            <span fxFlex></span>


                                            <!-- Short -->
                                            <div fxFlex="45" fxFlex.xs="100" fxFlex.sm="100">
                                                <!-- Short Prices -->
                                                <div class="desktop-card">
                                                    <!-- Header -->
                                                    <div fxLayout="row" fxLayoutAlign="center center" class="chart-header">
                                                        <h4>Short Prices</h4>
                                                        <span fxFlex></span>
                                                        <div class="square-badge-error clickable" role="button" matRipple
                                                            matTooltip="Short Prices Mean"
                                                            (click)="displayDataItems([_d.shortPrices])">
                                                            Mean: {{_d.shortPrices.mean | currency}}
                                                        </div>
                                                    </div>

                                                    <!-- Chart -->
                                                    <div class="chart">
                                                        <apx-chart
                                                            [series]="prices.short.series"
                                                            [chart]="prices.short.chart"
                                                            [dataLabels]="prices.short.dataLabels"
                                                            [xaxis]="prices.short.xaxis"
                                                            [yaxis]="prices.short.yaxis"
                                                            [stroke]="prices.short.stroke"
                                                        ></apx-chart>
                                                    </div>
                                                </div>
                                            </div>
                                            <span fxFlex></span>
                                        </div>
                                    </div>

                                    <!-- Positions -->
                                    <div *ngIf="activeSection.id == 'positions'" class="padding">
                                        <div fxLayout="row" fxLayoutAlign="center center">
                                            <div fxFlex="75" fxFlex.xs="100" fxFlex.sm="100">
                                                <!-- Positions Table -->
                                                <div class="desktop-card no-padding">
                                                    <table class="bordered highlight">
                                                        <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>Date</th>
                                                                <th>Type</th>
                                                                <th *ngIf="layout == 'desktop'">Price</th>
                                                                <th *ngIf="layout == 'desktop'">Amount</th>
                                                                <th *ngIf="layout == 'desktop'">Fee</th>
                                                                <th *ngIf="layout == 'desktop'">PNL</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr *ngFor="let position of _d.rPositions; let i = index" 
                                                                (click)="displayPosition(position)" class="clickable" role="button">
                                                                <td *ngIf="(i+1) <= visiblePositions">
                                                                    <p class="light-text">{{i+1}}</p>
                                                                </td>
                                                                <td *ngIf="(i+1) <= visiblePositions">
                                                                    <p class="show-on-desktop">{{position.openTime | date:'medium'}}</p>
                                                                    <p class="show-on-mobile">{{position.openTime | date:'shortDate'}}</p>
                                                                </td>
                                                                <td *ngIf="(i+1) <= visiblePositions" 
                                                                    [ngClass]="{
                                                                        'success-color': position.side == 'LONG', 
                                                                        'error-color': position.side == 'SHORT'
                                                                    }">
                                                                    {{position.side}}
                                                                </td>
                                                                <td *ngIf="(i+1) <= visiblePositions && layout == 'desktop'">
                                                                    <p>{{position.openPrice | currency}}</p>
                                                                </td>
                                                                <td *ngIf="(i+1) <= visiblePositions && layout == 'desktop'">
                                                                    <p>{{position.openAmount | currency}}</p>
                                                                </td>
                                                                <td *ngIf="(i+1) <= visiblePositions && layout == 'desktop'">
                                                                    <p>{{position.fee | currency}}</p>
                                                                </td>
                                                                <td *ngIf="(i+1) <= visiblePositions && layout == 'desktop'">
                                                                    <p [ngClass]="{
                                                                        'success-color': position.pnl > 0, 
                                                                        'error-color': position.pnl < 0,
                                                                        'light-text': position.pnl == 0
                                                                    }">
                                                                        <strong>{{position.pnl > 0 ? '+': ''}}{{position.pnl | currency}}</strong>
                                                                    </p>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
    
                                                <!-- Paginator -->
                                                <div *ngIf="visiblePositions <= _d.rPositions.length" class="paginator">
                                                    <button mat-button (click)="visiblePositions=visiblePositions+15">View More</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Mobile Tabs -->
        <app-mobile-tabs *ngIf="layout == 'mobile'"></app-mobile-tabs>
    </mat-drawer-content>
</mat-drawer-container>