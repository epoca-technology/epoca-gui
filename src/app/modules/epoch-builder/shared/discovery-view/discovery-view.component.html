<div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column">

    <div fxFlex="40" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
        <!-- Model -->
        <div class="desktop-card">
            <div fxLayout="row" fxLayoutAlign="start center" fxLayoutAlign.xs="center center" fxLayoutAlign.sm="center center">
                <img src="assets/img/model_logos/{{modelName}}.png" alt="Model Type" class="model-logo-xl">
                <div class="margin-left">
                    <h5 style="margin-bottom:5px;">{{modelName}}</h5>
                    <app-regression-element *ngIf="modelName == 'Regression'" [config]="modelConfig"></app-regression-element>
                    <app-prediction-model-element *ngIf="modelName == 'PredictionModel'" [config]="modelConfig"></app-prediction-model-element>
                </div>
            </div>
        </div>

        <div class="divider show-on-mobile"></div>

        <!-- Accuracy -->
        <div class="desktop-card">
            <div class="badged-header" fxLayout="row" fxLayoutAlign="start center">
                <h4 class="truncate">{{layout == 'desktop' ? 'Accuracy': 'Acc.'}}</h4>
                <span fxFlex></span>
                <div class="square-badge-success" matTooltip="Increase Accuracy">
                    {{discovery.increase_accuracy| number: '1.0-2'}}%
                </div>
                <div class="square-badge-error" matTooltip="Decrease Accuracy">
                    {{discovery.decrease_accuracy| number: '1.0-2'}}%
                </div>
                <div class="square-badge" matTooltip="Accuracy">
                    {{discovery.accuracy| number: '1.0-2'}}%
                </div>
            </div>
            <div>
                <apx-chart
                    [series]="accuracyChart.series"
                    [chart]="accuracyChart.chart"
                    [plotOptions]="accuracyChart.plotOptions"
                    [xaxis]="accuracyChart.xaxis"
                    [yaxis]="accuracyChart.yaxis"
                    [dataLabels]="accuracyChart.dataLabels"
                    [colors]="accuracyChart.colors"
                    [grid]="accuracyChart.grid"
                ></apx-chart>
            </div>
        </div>

        <div class="divider show-on-mobile"></div>

        <!-- Discovery -->
        <div class="desktop-card discovery-details no-padding">
            <div>
                <table class="highlight">
                    <thead>
                        <tr>
                            <th class="pred-header"><h5>Predictions</h5></th>
                            <th><mat-icon class="success-color" matTooltip="Increase">trending_up</mat-icon></th>
                            <th><mat-icon class="error-color" matTooltip="Decrease">trending_down</mat-icon></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Min</td>
                            <td class="success-color">{{discovery.increase_min | number: '1.0-2'}}</td>
                            <td class="error-color">{{discovery.decrease_min | number: '1.0-2'}}</td>
                        </tr>
                        <tr>
                            <td>Mean</td>
                            <td class="success-color">{{discovery.increase_mean | number: '1.0-2'}}</td>
                            <td class="error-color">{{discovery.decrease_mean | number: '1.0-2'}}</td>
                        </tr>
                        <tr>
                            <td>Median</td>
                            <td class="success-color">{{discovery.increase_median | number: '1.0-2'}}</td>
                            <td class="error-color">{{discovery.decrease_median | number: '1.0-2'}}</td>
                        </tr>
                        <tr>
                            <td>Max</td>
                            <td class="success-color">{{discovery.increase_max | number: '1.0-2'}}</td>
                            <td class="error-color">{{discovery.decrease_max | number: '1.0-2'}}</td>
                        </tr>
                    </tbody>
                </table>
                <table class="highlight margin-top">
                    <thead>
                        <tr>
                            <th class="pred-header"><h5>Successful</h5></th>
                            <th><mat-icon class="success-color" matTooltip="Increase">trending_up</mat-icon></th>
                            <th><mat-icon class="error-color" matTooltip="Decrease">trending_down</mat-icon></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Mean</td>
                            <td class="success-color">{{discovery.increase_successful_mean | number: '1.0-2'}}</td>
                            <td class="error-color">{{discovery.decrease_successful_mean | number: '1.0-2'}}</td>
                        </tr>
                        <tr>
                            <td>Median</td>
                            <td class="success-color">{{discovery.increase_successful_median | number: '1.0-2'}}</td>
                            <td class="error-color">{{discovery.decrease_successful_median | number: '1.0-2'}}</td>
                        </tr>
                    </tbody>
                </table>
                <table class="highlight margin-top">
                    <thead>
                        <tr class="pred-header">
                            <th class="pred-header"><h5>Unsuccessful</h5></th>
                            <th><mat-icon class="success-color" matTooltip="Increase">trending_up</mat-icon></th>
                            <th><mat-icon class="error-color" matTooltip="Decrease">trending_down</mat-icon></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Mean</td>
                            <td class="success-color">{{discovery.increase_unsuccessful_mean | number: '1.0-2'}}</td>
                            <td class="error-color">{{discovery.decrease_unsuccessful_mean | number: '1.0-2'}}</td>
                        </tr>
                        <tr>
                            <td>Median</td>
                            <td class="success-color">{{discovery.increase_unsuccessful_median | number: '1.0-2'}}</td>
                            <td class="error-color">{{discovery.decrease_unsuccessful_median | number: '1.0-2'}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <span fxFlex></span>
    <div class="divider show-on-mobile"></div>


    <div fxFlex="58" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
        <!-- Discovery Points -->
        <div class="desktop-card">
            <!-- Header -->
            <div fxLayout="row" fxLayoutAlign="start center">
                <h4>Points</h4>
                <span fxFlex></span>
                <div class="square-badge" 
                    matTooltip="Total number of points collected during the discovery process">
                    {{discovery.points | number: '1.0-2'}}
                </div>               
            </div>

            <!-- Points History -->
            <apx-chart
                [series]="pointsHistChart.series"
                [chart]="pointsHistChart.chart"
                [dataLabels]="pointsHistChart.dataLabels"
                [xaxis]="pointsHistChart.xaxis"
                [yaxis]="pointsHistChart.yaxis"
                [stroke]="pointsHistChart.stroke"
            ></apx-chart>
        </div>

        <div class="divider show-on-mobile"></div>


        <!-- Predictions Insight -->
        <div class="desktop-card">
            <!-- Header -->
            <div fxLayout="row" fxLayoutAlign="start center">
                <h4>{{layout == 'desktop' ? 'Prediction Insights': 'Insights'}}</h4>
                <span fxFlex></span>
                <button *ngIf="!insightsVisible" mat-button (click)="insightsVisible = true">View</button>
                <button *ngIf="insightsVisible" mat-button [matMenuTriggerFor]="menu" [ngClass]="activeInsight.class">
                    <mat-icon>{{activeInsight.icon}}</mat-icon>&nbsp;&nbsp;<span>{{activeInsight.name}}</span>
                </button>
                <mat-menu #menu="matMenu">
                    <button mat-menu-item 
                        *ngFor="let insight of predictionInsights; index as insightIndex"
                        [ngClass]="insight.class" 
                        [ngStyle]="{'opacity': activeInsight.name == insight.name ? '0.5': '1'}"
                        [disabled]="activeInsight.name == insight.name" (click)="activateInsight(insightIndex)">
                        <mat-icon>{{insight.icon}}</mat-icon> <span>{{insight.name}}</span>
                    </button>
                </mat-menu>                  
            </div>

            <!-- Prediction Insights -->
            <div *ngIf="insightsVisible">
                <apx-chart
                    [series]="predictionInsightChart.series"
                    [chart]="predictionInsightChart.chart"
                    [xaxis]="predictionInsightChart.xaxis"
                    [yaxis]="predictionInsightChart.yaxis"
                    [stroke]="predictionInsightChart.stroke"
                    [dataLabels]="{enabled: false}"
                    [markers]="{size: 0}"
                    [tooltip]="{enabled: false}"
                ></apx-chart>
            </div>
        </div>

        <div class="divider show-on-mobile"></div>

        <!-- Predictions vs Outcomes -->
        <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" class="full-width">
            <!-- Predictions-->
            <div fxFlex="49" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
                <div class="desktop-card no-margin">
                    <div class="badged-header" fxLayout="row" fxLayoutAlign="start center">
                        <h4 class="truncate">{{layout == 'desktop' ? 'Predictions': 'Preds.'}}</h4>
                        <span fxFlex></span>
                        <div class="square-badge-neutral" 
                            matTooltip="The number of neutral predictions generated by the Model.">
                            {{discovery.neutral_num | number}}
                        </div>
                        <div class="square-badge-success" 
                            matTooltip="The number of increase predictions generated by the Model.">
                            {{discovery.increase_num | number}}
                        </div>
                        <div class="square-badge-error" 
                            matTooltip="The number of decrease predictions generated by the Model.">
                            {{discovery.decrease_num | number}}
                        </div>
                        <div class="square-badge" 
                            matTooltip="The number of non-neutral predictions generated by the Model.">
                            {{discovery.increase_num + discovery.decrease_num | number}}
                        </div>
                    </div>

                    <div fxLayout="row" fxLayoutAlign="center center" class="full-width">
                        <apx-chart
                            [series]="predictionsChart.series"
                            [chart]="predictionsChart.chart"
                            [labels]="predictionsChart.labels"
                            [colors]="predictionsChart.colors"
                            [legend]="predictionsChart.legend"
                            [responsive]="predictionsChart.responsive"
                        ></apx-chart>
                    </div>
                </div>
            </div>

            <span fxFlex></span>
            <div class="divider show-on-mobile"></div>


            <!-- Outcomes-->
            <div fxFlex="49" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
                <div class="desktop-card no-margin">
                    <div class="badged-header" fxLayout="row" fxLayoutAlign="start center">
                        <h4 class="truncate">{{layout == 'desktop' ? 'Outcomes': 'Outs.'}}</h4>
                        <span fxFlex></span>
                        <div class="square-badge-neutral" 
                            matTooltip="The number of neutral outcomes during the discovery.">
                            {{discovery.neutral_outcome_num | number}}
                        </div>
                        <div class="square-badge-success" 
                            matTooltip="The number of increase outcomes during the discovery.">
                            {{discovery.increase_outcome_num | number}}
                        </div>
                        <div class="square-badge-error" 
                            matTooltip="The number of decrease outcomes during the discovery.">
                            {{discovery.decrease_outcome_num | number}}
                        </div>
                        <div class="square-badge" 
                            matTooltip="The total number outcomes during the discovery.">
                            {{discovery.increase_outcome_num + discovery.decrease_outcome_num | number}}
                        </div>
                    </div>

                    <div fxLayout="row" fxLayoutAlign="center center" class="full-width">
                        <apx-chart
                            [series]="outcomesChart.series"
                            [chart]="outcomesChart.chart"
                            [labels]="outcomesChart.labels"
                            [colors]="outcomesChart.colors"
                            [legend]="outcomesChart.legend"
                            [responsive]="outcomesChart.responsive"
                        ></apx-chart>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>