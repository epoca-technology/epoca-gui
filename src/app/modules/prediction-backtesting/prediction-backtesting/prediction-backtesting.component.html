<!-- Section Container -->
<mat-drawer-container class="section-container">

    <!-- Main Sidenav -->
    <mat-drawer #predBacktestingSidenav [(opened)]="predBacktestingSidenavOpened" *ngIf="initialized"
                class="sidenav" position="start" mode="over" autoFocus="false">
        <!-- Menu Heading Toolbar -->
        <mat-toolbar color="primary">
            <div fxLayout="row" fxLayoutAlign="start center">
                <button mat-icon-button (click)="predBacktestingSidenav?.toggle()"><mat-icon>arrow_back</mat-icon></button>
                <span>Prediction Backtesting</span>
                <span fxFlex></span>
            </div>
        </mat-toolbar>

        <!-- Menu Content -->
        <mat-list>
            <div mat-subheader>General</div>
            <mat-list-item *ngFor="let sect of generalSections">
                <button mat-button class="left-icon-button" [disabled]="section.id == sect.id" (click)="activateSection(sect)">
                    <mat-icon>{{sect.icon}}</mat-icon> {{sect.name}}
                </button>
            </mat-list-item>
            <div mat-subheader>Models</div>
            <mat-list-item *ngFor="let id of _backtesting.modelIDs">
                <button mat-button class="left-icon-button truncate" 
                        [disabled]="section.id == 'model' && modelID == id" 
                        (click)="activateSection({id: 'model', name: id}, id)">
                        <div fxLayout="row" fxLayoutAlign="start center">
                            <span class="truncate">{{id}}</span>
                            <span fxFlex></span>
                            <div class="badge"><span>{{_backtesting.performances[id].points}}</span></div>
                        </div>
                </button>
            </mat-list-item>
        </mat-list>
    </mat-drawer>


    <!-- Section Content -->
    <mat-drawer-content id="content-header">
        <!-- Content Header -->
        <mat-toolbar class="secondary-header">
            <div fxLayout="row" fxLayoutAlign="center center">
                <button mat-icon-button (click)="_nav.dashboard()" class="show-on-mobile" *ngIf="!initialized"><mat-icon>arrow_back</mat-icon></button>
                <button mat-icon-button (click)="resetResults()" class="show-on-mobile" *ngIf="initialized"><mat-icon>arrow_back</mat-icon></button>
                <button mat-icon-button (click)="predBacktestingSidenav?.toggle()" *ngIf="initialized" class="show-on-mobile"><mat-icon>menu</mat-icon></button>
                <span class="truncate show-on-mobile" *ngIf="!initialized">Prediction Backtesting</span>
                <span class="truncate show-on-mobile" *ngIf="initialized">{{section.id == 'model' ? modelID: section.name}}</span>
                <span class="truncate show-on-desktop">Prediction Backtesting</span>
                <span fxFlex></span>
                <button mat-icon-button 
                        matTooltip="Clear Backtest Results"
                        (click)="resetResults()"
                        class="show-on-desktop"
                        *ngIf="initialized"><mat-icon>close</mat-icon></button>
            </div>
        </mat-toolbar>



        <!-- Uninitialized Content -->
        <div *ngIf="!initialized" class="fadeIn">
            <div fxLayout="row" fxLayoutAlign="center center" class="init-container">
                <!-- Button -->
                <label for="backtestFile" class="file-label" role="button" matRipple *ngIf="!initializing">
                    <div fxLayout="row" fxLayoutAlign="start center" matRipple role="button" tabindex="0">
                        <mat-icon svgIcon="file_waveform"></mat-icon>&nbsp;
                        <p>Select Backtest Files</p>
                    </div>
                </label>

                <!-- Input -->
                <input id="backtestFile" type="file" accept="application/json" (change)="fileChanged($event)" multiple/>

                <!-- Initializing Loader-->
                <h3 *ngIf="initializing" class="fadeIn">Initializing...</h3>
            </div>
        </div>



        <!-- Initialized Content -->
        <div *ngIf="initialized" class="fadeIn">
            <div fxLayout="row">
                <div *ngIf="layout == 'desktop'" class="desktop-sidenav">
                    <mat-list>
                        <div mat-subheader>General</div>
                        <mat-list-item *ngFor="let sect of generalSections">
                            <button mat-button class="left-icon-button" [disabled]="section.id == sect.id" (click)="activateSection(sect)">
                                <mat-icon>{{sect.icon}}</mat-icon> {{sect.name}}
                            </button>
                        </mat-list-item>
                        <div mat-subheader>Models</div>
                        <mat-list-item *ngFor="let id of _backtesting.modelIDs">
                            <button mat-button class="left-icon-button truncate" 
                                    [disabled]="section.id == 'model' && modelID == id" 
                                    (click)="activateSection({id: 'model', name: id}, id)">
                                    <div fxLayout="row" fxLayoutAlign="start center">
                                        <span class="truncate">{{id}}</span>
                                        <span fxFlex></span>
                                        <div class="badge"><span>{{_backtesting.performances[id].points}}</span></div>
                                    </div>
                            </button>
                        </mat-list-item>
                    </mat-list>
                </div>
                <div fxFlex>
                    <!-- Loader -->
                    <div *ngIf="!loaded" class="loader">
                        <div fxLayout="row" fxLayoutAlign="center center"><mat-spinner diameter="50"></mat-spinner></div>
                    </div>

                    <!-- Sections -->
                    <div *ngIf="loaded" class="fadeIn">

                        <!-- General Sections -->
                        <div *ngIf="section.id != 'model'" fxLayout="row" fxLayoutAlign="center center" class="general-sections">
                            <div fxFlex="90" fxFlex.xs="100" fxflex.sm="100">

                                <!-- Points Section -->
                                <div *ngIf="section.id == 'points' && pointsDistChart && pointsLineChart">
                                    <!-- Distribution -->
                                    <div class="desktop-card">
                                        <div fxLayout="row" fxLayoutAlign="center center">
                                            <h3 class="show-on-desktop">Points Accumulated</h3>
                                            <span class="show-on-desktop" fxFlex></span>
                                            <div class="square-badge-success clickable" role="button"
                                                (click)="displayModel(_backtesting.pointsMD.max.id)" 
                                                matTooltip="{{_backtesting.pointsMD.max.id}}">
                                                Best: {{_backtesting.pointsMD.max.value}}
                                            </div>
                                            <div class="square-badge-error clickable low" role="button" 
                                                (click)="displayModel(_backtesting.pointsMD.min.id)" 
                                                matTooltip="{{_backtesting.pointsMD.min.id}}">
                                                Worst: {{_backtesting.pointsMD.min.value}}
                                            </div>
                                        </div>
                                        <div>
                                            <apx-chart
                                                [series]="pointsDistChart.series"
                                                [chart]="pointsDistChart.chart"
                                                [plotOptions]="pointsDistChart.plotOptions"
                                                [xaxis]="pointsDistChart.xaxis"
                                                [dataLabels]="pointsDistChart.dataLabels"
                                                [colors]="pointsDistChart.colors"
                                                [grid]="pointsDistChart.grid"
                                                [legend]="{show: false}"
                                            ></apx-chart>
                                        </div>
                                    </div>

                                    <!-- Lines -->
                                    <div class="desktop-card">
                                        <div fxLayout="row" fxLayoutAlign="center center">
                                            <h3 class="show-on-desktop">Points Accumulation History</h3>
                                            <span class="show-on-desktop" fxFlex></span>
                                            <div class="square-badge-success clickable" role="button"
                                                (click)="displayModel(_backtesting.pointsHistoryMD.max.id)" 
                                                matTooltip="{{_backtesting.pointsHistoryMD.max.id}}">
                                                High: {{_backtesting.pointsHistoryMD.max.value}}
                                            </div>
                                            <div class="square-badge-error clickable low" role="button"
                                                (click)="displayModel(_backtesting.pointsHistoryMD.min.id)" 
                                                matTooltip="{{_backtesting.pointsHistoryMD.min.id}}">
                                                Low: {{_backtesting.pointsHistoryMD.min.value}}
                                            </div>
                                        </div>
                                        <div>
                                            <apx-chart
                                                [series]="pointsLineChart.series"
                                                [chart]="pointsLineChart.chart"
                                                [xaxis]="pointsLineChart.xaxis"
                                                [dataLabels]="pointsLineChart.dataLabels"
                                                [grid]="pointsLineChart.grid"
                                                [stroke]="pointsLineChart.stroke"
                                                [yaxis]="pointsLineChart.yaxis"
                                            ></apx-chart>
                                        </div>
                                    </div>
                                </div>

                                <!-- Accuracy Section -->
                                <div *ngIf="section.id == 'accuracy' && accuracyChart">
                                    <div class="desktop-card">
                                        <div fxLayout="row" fxLayoutAlign="center center">
                                            <h3 class="show-on-desktop">Accuracy</h3>
                                            <span class="show-on-desktop" fxFlex></span>
                                            <button mat-icon-button 
                                                    [disabled]="accuracyView == 0" 
                                                    (click)="accuracyView = accuracyView - 1">
                                                    <mat-icon>arrow_left</mat-icon>
                                            </button>
                                            <div *ngIf="accuracyView == 0" class="fadeIn" fxLayout="row">
                                                <div class="square-badge-success clickable" role="button" 
                                                    matTooltip="Best Long Accuracy: {{_backtesting.accuracyMD.long.max.id}}"
                                                    (click)="displayModel(_backtesting.accuracyMD.long.max.id)">
                                                    Best: {{_backtesting.accuracyMD.long.max.value}}%
                                                </div>
                                                <div class="square-badge-success clickable low" role="button" 
                                                    matTooltip="Worst Long Accuracy: {{_backtesting.accuracyMD.long.min.id}}"
                                                    (click)="displayModel(_backtesting.accuracyMD.long.min.id)">
                                                    Worst: {{_backtesting.accuracyMD.long.min.value}}%
                                                </div>
                                            </div>
                                            <div *ngIf="accuracyView == 1" class="fadeIn" fxLayout="row">
                                                <div class="square-badge-error clickable" role="button" 
                                                    matTooltip="Best Short Accuracy: {{_backtesting.accuracyMD.short.max.id}}"
                                                    (click)="displayModel(_backtesting.accuracyMD.short.max.id)">
                                                    Best: {{_backtesting.accuracyMD.short.max.value}}%
                                                </div>
                                                <div class="square-badge-error clickable low" role="button" 
                                                    matTooltip="Worst Short Accuracy: {{_backtesting.accuracyMD.short.min.id}}"
                                                    (click)="displayModel(_backtesting.accuracyMD.short.min.id)">
                                                    Worst: {{_backtesting.accuracyMD.short.min.value}}%
                                                </div>
                                            </div>
                                            <div *ngIf="accuracyView == 2" class="fadeIn" fxLayout="row">
                                                <div class="square-badge clickable" role="button" 
                                                    matTooltip="Best General Accuracy: {{_backtesting.accuracyMD.general.max.id}}"
                                                    (click)="displayModel(_backtesting.accuracyMD.general.max.id)">
                                                    Best: {{_backtesting.accuracyMD.general.max.value}}%
                                                </div>
                                                <div class="square-badge clickable low" role="button" 
                                                    matTooltip="Worst General Accuracy: {{_backtesting.accuracyMD.general.min.id}}"
                                                    (click)="displayModel(_backtesting.accuracyMD.general.min.id)">
                                                    Worst: {{_backtesting.accuracyMD.general.min.value}}%
                                                </div>
                                            </div>
                                            <button mat-icon-button 
                                                    [disabled]="accuracyView == 2" 
                                                    (click)="accuracyView = accuracyView + 1">
                                                    <mat-icon>arrow_right</mat-icon>
                                            </button>
                                        </div>
                                        <div>
                                            <apx-chart
                                                [series]="accuracyChart.series"
                                                [chart]="accuracyChart.chart"
                                                [plotOptions]="accuracyChart.plotOptions"
                                                [xaxis]="accuracyChart.xaxis"
                                                [dataLabels]="accuracyChart.dataLabels"
                                                [colors]="accuracyChart.colors"
                                                [grid]="accuracyChart.grid"
                                            ></apx-chart>
                                        </div>
                                    </div>
                                </div>


                                <!-- Positions Section -->
                                <div *ngIf="section.id == 'positions' && positionsChart">
                                    <div class="desktop-card">
                                        <div fxLayout="row" fxLayoutAlign="center center">
                                            <h3 class="show-on-desktop">Positions</h3>
                                            <span class="show-on-desktop" fxFlex></span>
                                            <button mat-icon-button 
                                                    [disabled]="positionsView == 0" 
                                                    (click)="positionsView = positionsView - 1">
                                                    <mat-icon>arrow_left</mat-icon>
                                            </button>
                                            <div *ngIf="positionsView == 0" class="fadeIn" fxLayout="row">
                                                <div class="square-badge-success clickable" role="button" 
                                                    matTooltip="Highest # of Longs: {{_backtesting.positionsMD.long.max.id}}"
                                                    (click)="displayModel(_backtesting.positionsMD.long.max.id)">
                                                    High: {{_backtesting.positionsMD.long.max.value}}
                                                </div>
                                                <div class="square-badge-success clickable low" role="button" 
                                                    matTooltip="Lowest # of Longs: {{_backtesting.positionsMD.long.min.id}}"
                                                    (click)="displayModel(_backtesting.positionsMD.long.min.id)">
                                                    Low: {{_backtesting.positionsMD.long.min.value}}
                                                </div>
                                            </div>
                                            <div *ngIf="positionsView == 1" class="fadeIn" fxLayout="row">
                                                <div class="square-badge-error clickable" role="button" 
                                                    matTooltip="Highest # of Shorts: {{_backtesting.positionsMD.short.max.id}}"
                                                    (click)="displayModel(_backtesting.positionsMD.short.max.id)">
                                                    High: {{_backtesting.positionsMD.short.max.value}}
                                                </div>
                                                <div class="square-badge-error clickable low" role="button" 
                                                    matTooltip="Lowest # of Shorts: {{_backtesting.positionsMD.short.min.id}}"
                                                    (click)="displayModel(_backtesting.positionsMD.short.min.id)">
                                                    Low: {{_backtesting.positionsMD.short.min.value}}
                                                </div>
                                            </div>
                                            <div *ngIf="positionsView == 2" class="fadeIn" fxLayout="row">
                                                <div class="square-badge clickable" role="button" 
                                                    matTooltip="Highest # of Positions: {{_backtesting.positionsMD.general.max.id}}"
                                                    (click)="displayModel(_backtesting.positionsMD.general.max.id)">
                                                    High: {{_backtesting.positionsMD.general.max.value}}
                                                </div>
                                                <div class="square-badge clickable low" role="button" 
                                                    matTooltip="Lowest # of Positions: {{_backtesting.positionsMD.general.min.id}}"
                                                    (click)="displayModel(_backtesting.positionsMD.general.min.id)">
                                                    Low: {{_backtesting.positionsMD.general.min.value}}
                                                </div>
                                            </div>
                                            <button mat-icon-button 
                                                    [disabled]="positionsView == 2" 
                                                    (click)="positionsView = positionsView + 1">
                                                    <mat-icon>arrow_right</mat-icon>
                                            </button>
                                        </div>
                                        <div>
                                            <apx-chart
                                                [series]="positionsChart.series"
                                                [chart]="positionsChart.chart"
                                                [plotOptions]="positionsChart.plotOptions"
                                                [xaxis]="positionsChart.xaxis"
                                                [dataLabels]="positionsChart.dataLabels"
                                                [colors]="positionsChart.colors"
                                                [grid]="positionsChart.grid"
                                            ></apx-chart>
                                        </div>
                                    </div>
                                </div>


                                <!-- Duration Section -->
                                <div *ngIf="section.id == 'duration' && durationChart">
                                    <div class="desktop-card">
                                        <div fxLayout="row" fxLayoutAlign="center center">
                                            <h3 class="show-on-desktop">Backtest Duration</h3>
                                            <span class="show-on-desktop" fxFlex></span>
                                            <div class="square-badge clickable" role="button"
                                                (click)="displayModel(_backtesting.durationMD.min.id)" 
                                                matTooltip="{{_backtesting.durationMD.min.id}}">
                                                Fastest: {{_backtesting.durationMD.min.value}} mins
                                            </div>
                                            <div class="square-badge clickable" role="button" style="margin-left:5px;"
                                                (click)="displayModel(_backtesting.durationMD.max.id)" 
                                                matTooltip="{{_backtesting.durationMD.max.id}}">
                                                Slowest: {{_backtesting.durationMD.max.value}}
                                            </div>
                                        </div>
                                        <div>
                                            <apx-chart
                                                [series]="durationChart.series"
                                                [chart]="durationChart.chart"
                                                [plotOptions]="durationChart.plotOptions"
                                                [xaxis]="durationChart.xaxis"
                                                [dataLabels]="durationChart.dataLabels"
                                                [colors]="durationChart.colors"
                                                [grid]="durationChart.grid"
                                                [legend]="{show: false}"
                                            ></apx-chart>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Model Sections -->
                        <div *ngIf="section.id == 'model' && modelID">
                            <!-- Tabs Navigation-->
                            <mat-tab-group *ngIf="layout == 'mobile'" 
                                        [selectedIndex]="activeIndex" (selectedIndexChange)="activeIndex = $event"
                                        class="mat-elevation-z3" mat-stretch-tabs mat-align-tabs="center" backgroundColor="primary">
                                <mat-tab label="Summary"></mat-tab>
                                <mat-tab label="Positions"></mat-tab>
                            </mat-tab-group>
                            <mat-tab-group *ngIf="layout == 'desktop'"  
                                            [selectedIndex]="activeIndex" (selectedIndexChange)="activeIndex = $event" 
                                            mat-align-tabs="center">
                                <mat-tab label="Summary"></mat-tab>
                                <mat-tab label="Positions"></mat-tab>
                            </mat-tab-group>

                            <!-- Content -->
                            <div class="padding">
                                <!-- Summary Section -->
                                <div *ngIf="activeIndex == 0" class="fadeIn summary-section">
                                    <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column">
                                        <!-- Summary Cards-->
                                        <div fxFlex="49" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
                                            <!-- Backtest -->
                                            <div class="desktop-card">
                                                <!-- Heading -->
                                                <div fxLayout="row" fxLayoutAlign="start center">
                                                    <h4>Backtest</h4>
                                                    <span fxFlex></span>
                                                    <button mat-icon-button 
                                                            matTooltip="Copy Backtest Summary" 
                                                            (click)="copyBacktestSummary()"><mat-icon>receipt_long</mat-icon></button>
                                                </div>

                                                <!-- Description -->
                                                <p class="light-text">{{_backtesting.backtests[modelID].description}}</p>

                                                <!-- Backtest ID -->
                                                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                    <p class="light-text truncate">Backtest ID</p>
                                                    <span fxFlex></span>
                                                    <p>{{_backtesting.backtests[modelID].id}}</p>
                                                </div>

                                                <!-- Start Date -->
                                                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                    <p class="light-text truncate">Start</p>
                                                    <span fxFlex></span>
                                                    <p matTooltip="The Open Time of the first candlestick used for the test.">
                                                        {{_backtesting.backtests[modelID].start | date:'medium'}}
                                                    </p>
                                                </div>

                                                <!-- End Date -->
                                                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                    <p class="light-text truncate">End</p>
                                                    <span fxFlex></span>
                                                    <p matTooltip="The Close Time of the last candlestick used for the test.">
                                                        {{_backtesting.backtests[modelID].end | date:'medium'}}
                                                    </p>
                                                </div>

                                               <!-- Position Exit Percentages -->
                                               <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                    <p class="light-text truncate">Position Exit</p>
                                                    <span fxFlex></span>
                                                    <p class="success-color" matTooltip="Take Profit">{{_backtesting.backtests[modelID].take_profit}}%</p>
                                                    <p>&nbsp;/&nbsp;</p>
                                                    <p class="error-color" matTooltip="Stop Loss">{{_backtesting.backtests[modelID].stop_loss}}%</p>
                                                </div>

                                                <!-- Idle Minutes -->
                                                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                     <p class="light-text truncate">Idle Minutes</p>
                                                     <span fxFlex></span>
                                                     <p matTooltip="The number of minutes the model remained idle every time it closed a position.">
                                                         {{_backtesting.backtests[modelID].idle_minutes_on_position_close}} mins
                                                    </p>
                                                </div>

                                                <!-- Model's Backtest Duration -->
                                                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                                                    <p class="light-text truncate">Model Backtest Duration</p>
                                                    <span fxFlex></span>
                                                    <p matTooltip="The number of minutes it took the model to complete the backtest.">
                                                        {{_backtesting.backtests[modelID].model_duration}} mins
                                                    </p>
                                               </div>
                                            </div>

                                            <div class="divider"></div>

                                            <!-- Model -->
                                            <div class="desktop-card">
                                                <!-- Heading -->
                                                <div fxLayout="row" fxLayoutAlign="start center">
                                                    <h4 *ngIf="_backtesting.models[modelID].single_models.length == 0">Decision Model</h4>
                                                    <h4 *ngIf="_backtesting.models[modelID].single_models.length == 1">Single Model</h4>
                                                    <h4 *ngIf="_backtesting.models[modelID].single_models.length > 1">Multi Model</h4>
                                                    <span fxFlex></span>
                                                    <div class="square-badge">{{_backtesting.models[modelID].single_models.length}}</div>
                                                </div>

                                                <!-- Content -->
                                                <div class="margin-top">
                                                    <app-model-content [model]="_backtesting.models[modelID]"></app-model-content>
                                                </div>
                                            </div>
                                        </div>

                                        <span fxFlex></span>

                                        <!-- Chart Cards-->
                                        <div fxFlex="49" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
                                            <!-- Divider for mobile-->
                                            <div class="divider"></div>

                                            <!-- Points -->
                                            <div class="desktop-card">
                                                <div fxLayout="row" fxLayoutAlign="start center">
                                                    <h4>Points</h4>
                                                    <span fxFlex></span>
                                                    <div class="square-badge low show-on-desktop">High: {{modelPointsRange.max}}</div>
                                                    <div class="square-badge low show-on-desktop">Low: {{modelPointsRange.min}}</div>
                                                    <div class="square-badge">Final: {{_backtesting.performances[modelID].points}}</div>
                                                </div>
                                                <apx-chart
                                                    [series]="modelCharts[modelID].points.series"
                                                    [chart]="modelCharts[modelID].points.chart"
                                                    [plotOptions]="modelCharts[modelID].points.plotOptions"
                                                    [xaxis]="modelCharts[modelID].points.xaxis"
                                                    [dataLabels]="modelCharts[modelID].points.dataLabels"
                                                    [colors]="modelCharts[modelID].points.colors"
                                                    [grid]="modelCharts[modelID].points.grid"
                                                    [legend]="{show: false}"
                                                    [yaxis]="modelCharts[modelID].points.yaxis"
                                                ></apx-chart>
                                            </div>
                                            <div class="divider"></div>

                                            <!-- Accuracy -->
                                            <div class="desktop-card">
                                                <div fxLayout="row" fxLayoutAlign="start center">
                                                    <h4 class="show-on-desktop">Accuracy</h4>
                                                    <h4 class="show-on-mobile">Acc.</h4>
                                                    <span fxFlex></span>
                                                    <div class="square-badge-success low">{{_backtesting.performances[modelID].long_acc}}%</div>
                                                    <div class="square-badge-error low">{{_backtesting.performances[modelID].short_acc}}%</div>
                                                    <div class="square-badge">{{_backtesting.performances[modelID].general_acc}}%</div>
                                                </div>
                                                <apx-chart
                                                    [series]="modelCharts[modelID].accuracy.series"
                                                    [chart]="modelCharts[modelID].accuracy.chart"
                                                    [plotOptions]="modelCharts[modelID].accuracy.plotOptions"
                                                    [xaxis]="modelCharts[modelID].accuracy.xaxis"
                                                    [yaxis]="modelCharts[modelID].accuracy.yaxis"
                                                    [dataLabels]="modelCharts[modelID].accuracy.dataLabels"
                                                    [colors]="modelCharts[modelID].accuracy.colors"
                                                    [grid]="modelCharts[modelID].accuracy.grid"
                                                ></apx-chart>
                                            </div>
                                            <div class="divider"></div>

                                            <!-- Positions -->
                                            <div class="desktop-card">
                                                <div fxLayout="row" fxLayoutAlign="start center">
                                                    <h4 class="show-on-desktop">Positions</h4>
                                                    <h4 class="show-on-mobile">Pos.</h4>
                                                    <span fxFlex></span>
                                                    <div class="square-badge-success low">{{_backtesting.performances[modelID].long_num}}</div>
                                                    <div class="square-badge-error low">{{_backtesting.performances[modelID].short_num}}</div>
                                                    <div class="square-badge">{{_backtesting.performances[modelID].positions.length}}</div>
                                                </div>
                                                <apx-chart
                                                    [series]="modelCharts[modelID].positions.series"
                                                    [chart]="modelCharts[modelID].positions.chart"
                                                    [plotOptions]="modelCharts[modelID].positions.plotOptions"
                                                    [xaxis]="modelCharts[modelID].positions.xaxis"
                                                    [yaxis]="modelCharts[modelID].positions.yaxis"
                                                    [dataLabels]="modelCharts[modelID].positions.dataLabels"
                                                    [colors]="modelCharts[modelID].positions.colors"
                                                    [grid]="modelCharts[modelID].positions.grid"
                                                ></apx-chart>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <!-- Positions Section-->
                                <div *ngIf="activeIndex == 1" class="fadeIn">
                                    <div fxLayout="row" fxLayoutAlign="center center">
                                        <div fxFlex="60" fxFlex.xs="100" fxFlex.sm="100">
                                            <!-- Positions Table -->
                                            <div class="desktop-card positions">
                                                <table class="bordered highlight">
                                                    <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Open</th>
                                                            <th *ngIf="layout == 'desktop'">Close</th>
                                                            <th>Type</th>
                                                            <th>Points</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngFor="let p of _backtesting.performances[modelID].positions; let i = index" 
                                                            (click)="displayPosition(p)" class="clickable" role="button">
                                                            <td *ngIf="(i+1) <= visiblePositions">
                                                                <p class="light-text">{{i+1}}</p>
                                                            </td>
                                                            <td *ngIf="(i+1) <= visiblePositions">
                                                                <p class="show-on-mobile">{{p.ot | date:'short'}}</p>
                                                                <p class="show-on-desktop">{{p.ot | date:'medium'}}</p>
                                                            </td>
                                                            <td *ngIf="(i+1) <= visiblePositions && layout == 'desktop'">
                                                                <p>{{p.ct | date:'medium'}}</p>
                                                            </td>
                                                            <td *ngIf="(i+1) <= visiblePositions">
                                                                <p [ngClass]="{'success-color': p.t == 1, 'error-color': p.t == -1}">
                                                                    {{p.t == 1 ? 'Long': 'Short'}}
                                                                </p>
                                                            </td>
                                                            <td *ngIf="(i+1) <= visiblePositions" class="align-right">
                                                                <p [ngClass]="{'success-color': p.o, 'error-color': !p.o}">
                                                                    <strong>{{p.pts}}</strong>
                                                                </p>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                            <!-- Paginator -->
                                            <div *ngIf="visiblePositions <= _backtesting.performances[modelID].positions.length" class="paginator">
                                                <button mat-button (click)="visiblePositions=visiblePositions+15">View More</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </mat-drawer-content>
</mat-drawer-container>