<!-- Secondary Header -->
<mat-toolbar class="secondary-header">
    <div fxLayout="row" fxLayoutAlign="center center">
        <button mat-icon-button (click)="_nav.dashboard()" class="show-on-mobile" *ngIf="!initialized"><mat-icon>arrow_back</mat-icon></button>
        <button mat-icon-button (click)="reset()" class="show-on-mobile" *ngIf="initialized"><mat-icon>arrow_back</mat-icon></button>
        <span class="truncate">Class. Training Data</span>
        <span fxFlex></span>
        <button mat-icon-button 
                matTooltip="Clear Backtest Results"
                (click)="reset()"
                class="show-on-desktop"
                *ngIf="initialized"><mat-icon>close</mat-icon></button>
    </div>
</mat-toolbar>

<!-- Content -->
<div class="component">
    <!-- Uninitialized Content -->
    <div *ngIf="!initialized" class="fadeIn">
        <div fxLayout="row" fxLayoutAlign="center center" class="file-init-container">
            <!-- Button -->
            <label for="trainingDataFile" class="file-label" role="button" matRipple *ngIf="!initializing">
                <div fxLayout="row" fxLayoutAlign="start center" matRipple role="button" tabindex="0">
                    <mat-icon svgIcon="file_invoice"></mat-icon>&nbsp;
                    <p>Select Training Data File</p>
                </div>
            </label>

            <!-- Input -->
            <form [formGroup]="fileInputForm">
                <input id="trainingDataFile" type="file" accept="application/json" 
                        formControlName="fileInput" (change)="fileChanged($event)"/>
            </form>

            <!-- Initializing Loader-->
            <h3 *ngIf="initializing" class="fadeIn">Initializing...</h3>
        </div>
    </div>
    

    <!-- Initialized Content -->
    <div *ngIf="initialized">
        <!-- Tabs Navigation-->
        <mat-tab-group *ngIf="layout == 'mobile'" 
                    [selectedIndex]="activeIndex" (selectedIndexChange)="activeIndex = $event"
                    class="mat-elevation-z3" mat-stretch-tabs mat-align-tabs="center" backgroundColor="primary">
            <mat-tab label="Summary"></mat-tab>
            <mat-tab label="Data"></mat-tab>
        </mat-tab-group>
        <mat-tab-group *ngIf="layout == 'desktop'"  
                        [selectedIndex]="activeIndex" (selectedIndexChange)="activeIndex = $event" 
                        mat-align-tabs="center">
            <mat-tab label="Summary"></mat-tab>
            <mat-tab label="Data"></mat-tab>
        </mat-tab-group>


        <!-- Summary Section -->
        <div *ngIf="activeIndex == 0" class="summary-section fadeIn">
            <div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column">
                <!-- Info Cards-->
                <div fxFlex="46" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
                    <!-- General Information -->
                    <div class="desktop-card">
                        <h3>General Information</h3>

                        <!-- Description -->
                        <p class="ts-m margin-top">{{_td.description}}</p>

                        <!-- ID -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">ID</p>
                            <span fxFlex></span>
                            <p class="clickable" (click)="_clipboard.copy(_td.id)">{{_td.id | stringOverview: 10}}</p>
                        </div>

                        <!-- Regression Selection ID -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">Regr. Selection</p>
                            <span fxFlex></span>
                            <p class="clickable" (click)="_clipboard.copy(_td.regression_selection_id)">
                                {{_td.regression_selection_id | stringOverview: 10}}
                            </p>
                        </div>

                        <!-- Creation -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">Creation</p>
                            <span fxFlex></span>
                            <p>{{_td.creation | date:'medium'}}</p>
                        </div>

                        <!-- Start -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">Start</p>
                            <span fxFlex></span>
                            <p matTooltip="First Candlestick's Open Time">{{_td.start | date:'medium'}}</p>
                        </div>

                        <!-- End -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">End</p>
                            <span fxFlex></span>
                            <p matTooltip="Last Candlestick's Close Time">{{_td.end | date:'medium'}}</p>
                        </div>

                        <!-- Duration -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">Duration</p>
                            <span fxFlex></span>
                            <p matTooltip="Number of minutes it took to build the data.">{{_td.duration_minutes}} mins</p>
                        </div>

                        <!-- Steps -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">Steps</p>
                            <span fxFlex></span>
                            <p matTooltip="The number of prediction candlesticks it will skip for every position when building \
                            the data regardless of how long a position takes to be closed.">
                                {{_td.steps}}
                            </p>
                        </div>

                        <!-- Up & Down Percent Changes-->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">Price Actions</p>
                            <span fxFlex></span>
                            <p class="success-color" matTooltip="Up Percent Change">{{_td.up_percent_change}}%</p>
                            <p>&nbsp;/&nbsp;</p>
                            <p class="error-color" matTooltip="Down Percent Change">{{_td.down_percent_change}}%</p>
                        </div>

                        <!-- RSI -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">RSI</p>
                            <span fxFlex></span>
                            <p [ngClass]="{'success-color': _td.include_rsi, 'light-text': !_td.include_rsi}" 
                                matTooltip="If enabled, the RSI will be included as a feature.">
                                {{_td.include_rsi ? 'Enabled': 'Disabled'}}
                            </p>
                        </div>

                        <!-- Stoch -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">Stoch</p>
                            <span fxFlex></span>
                            <p [ngClass]="{'success-color': _td.include_stoch, 'light-text': !_td.include_stoch}" 
                                matTooltip="If enabled, the Stoch will be included as a feature.">
                                {{_td.include_stoch ? 'Enabled': 'Disabled'}}
                            </p>
                        </div>

                        <!-- Aroon -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">Aroon</p>
                            <span fxFlex></span>
                            <p [ngClass]="{'success-color': _td.include_aroon, 'light-text': !_td.include_aroon}" 
                                matTooltip="If enabled, Aroon will be included a feature.">
                                {{_td.include_aroon ? 'Enabled': 'Disabled'}}
                            </p>
                        </div>

                        <!-- STC -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">STC</p>
                            <span fxFlex></span>
                            <p [ngClass]="{'success-color': _td.include_stc, 'light-text': !_td.include_stc}" 
                                matTooltip="If enabled, the STC will be included as features.">
                                {{_td.include_stc ? 'Enabled': 'Disabled'}}
                            </p>
                        </div>

                        <!-- MFI -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">MFI</p>
                            <span fxFlex></span>
                            <p [ngClass]="{'success-color': _td.include_mfi, 'light-text': !_td.include_mfi}" 
                                matTooltip="If enabled, the MFI will be included as features.">
                                {{_td.include_mfi ? 'Enabled': 'Disabled'}}
                            </p>
                        </div>

                        <!-- Shape -->
                        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                            <p class="light-text truncate">Shape</p>
                            <span fxFlex></span>
                            <p matTooltip="Rows, Columns">({{_td.training_data.rows.length}}, {{_td.training_data.columns.length}})</p>
                        </div>

                        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutAlign.xs="center center" fxLayoutAlign.sm="center center" class="margin-top">
                            <p class="light-text show-on-desktop">Class.</p>
                            <span fxFlex class="show-on-desktop"></span>
                            <div fxLayout="row" fxLayoutAlign="start center">
                                <p class="formula clickable" role="button" 
                                    (click)="_nav.displayModelListDialog(_td.modelList)"
                                    matTooltip="Features: The list of ArimaModel|RegressionModel (or other pieces of data)\
                                     that comprise the Classification.">
                                    [{{_td.features_num}}] ->
                                </p>
                                <p class="formula">
                                    &nbsp;KerasClassificationModel
                                </p>
                                <p class="formula" 
                                    matTooltip="Labels: The probabilities for an up or down price action to take place.">
                                    &nbsp;-> [2]
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="divider show-on-mobile"></div>

                    <!-- Price Actions -->
                    <div class="desktop-card">
                        <h3>Price Actions</h3>
                        <apx-chart
                            [series]="priceActions.series"
                            [chart]="priceActions.chart"
                            [labels]="priceActions.labels"
                            [colors]="priceActions.colors"
                            [responsive]="priceActions.responsive"
                        ></apx-chart>
                    </div>
                </div>

                <span fxFlex></span>

                <div class="divider show-on-mobile"></div>

                <!-- Predictions Chart Card-->
                <div fxFlex="52" fxFlex.xs="100" fxFlex.sm="100" class="full-width">
                    <div class="desktop-card">
                        <h3>Predictions</h3>
                        <apx-chart
                            [series]="predictions.series"
                            [chart]="predictions.chart"
                            [plotOptions]="predictions.plotOptions"
                            [xaxis]="predictions.xaxis"
                            [yaxis]="predictions.yaxis"
                            [dataLabels]="predictions.dataLabels"
                            [colors]="predictions.colors"
                            [grid]="predictions.grid"
                        ></apx-chart>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Section -->
        <div *ngIf="activeIndex == 1" class="data-section fadeIn">
            <div fxLayout="row" fxLayoutAlign="center center">
                <div fxFlex="100">
                    <!-- Table -->
                    <div class="data-container" [ngClass]="{'mat-elevation-z3' : layout == 'desktop'}">
                        <table class="table highlight bordered">
                            <thead>
                                <tr>
                                    <th *ngFor="let column_name of _td.training_data.columns">{{column_name}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let row of visibleRows; index as rowIndex" 
                                    class="clickable" 
                                    (click)="_nav.displayDataDialog('trainingDataRow', row)">
                                    <td *ngFor="let column_name of _td.training_data.columns; index as columnIndex">
                                        <!-- Regression Features -->
                                        <div *ngIf="column_name != 'RSI' && column_name != 'STOCH' && column_name != 'AROON' && column_name != 'STC' && column_name != 'MFI' && 
                                                column_name != 'up' && column_name != 'down'">
                                            <mat-icon *ngIf="row[columnIndex] == 1" class="success-color">trending_up</mat-icon>
                                            <mat-icon *ngIf="row[columnIndex] == -1" class="error-color">trending_down</mat-icon>
                                        </div>

                                        <!-- TA Features -->
                                        <div *ngIf="column_name == 'RSI' || column_name == 'STOCH' || column_name == 'AROON' || column_name == 'STC' || column_name == 'MFI'">
                                            <p>{{row[columnIndex] | number: '1.0-2'}}</p>
                                        </div>

                                        <!-- Labels -->
                                        <div *ngIf="column_name == 'up' || column_name == 'down'">
                                            <mat-icon *ngIf="row[columnIndex] == 1 && column_name == 'up'" class="success-color">north</mat-icon>
                                            <mat-icon *ngIf="row[columnIndex] == 1 && column_name == 'down'" class="error-color">south</mat-icon>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Paginator -->
                    <div class="margin-top" 
                        fxLayout="row" 
                        fxLayoutAlign="end center" 
                        fxLayoutAlign.xs="center center" 
                        fxLayoutAlign.sm="center center">
                        <p class="light-text ts-s">{{rowsStart}} - {{rowsEnd}} of {{_td.training_data.rows.length}}</p>
                        <button mat-icon-button (click)="gotoStart()" [disabled]="rowsStart == 0"><mat-icon>first_page</mat-icon></button>
                        <button mat-icon-button (click)="goBackward()" [disabled]="rowsStart == 0"><mat-icon>navigate_before</mat-icon></button>
                        <button mat-icon-button (click)="goForward()" [disabled]="rowsEnd == _td.training_data.rows.length"><mat-icon>navigate_next</mat-icon></button>
                        <button mat-icon-button (click)="gotoEnd()" [disabled]="rowsEnd == _td.training_data.rows.length"><mat-icon>last_page</mat-icon></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
