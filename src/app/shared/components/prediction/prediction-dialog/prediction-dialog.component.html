<mat-toolbar mat-dialog-title color="primary" fxLayout="row" fxLayoutAlign="start center">
    <div fxLayout="row" fxLayoutAlign="center center">
        <button mat-icon-button class="show-on-mobile" (click)="close()"><mat-icon>arrow_back</mat-icon></button>
        <span class="truncate">{{resultName}} Prediction</span>
        <span fxFlex></span>
        <button mat-icon-button matTooltip="Display Model" (click)="_nav.displayModelDialog(model)"><mat-icon svgIcon="brain"></mat-icon></button>
        <button mat-icon-button class="show-on-desktop" (click)="close()"><mat-icon>close</mat-icon></button>
    </div>
</mat-toolbar>
<div mat-dialog-content>
    <!-- Loader -->
    <div *ngIf="!loaded">
        <div class="loader show-on-desktop"><div fxLayout="row" fxLayoutAlign="center center"><mat-spinner diameter="50"></mat-spinner></div></div>
        <div class="section-loader show-on-mobile"><div fxLayout="row" fxLayoutAlign="center center"><mat-spinner diameter="50"></mat-spinner></div></div>
    </div>

    <!-- Container -->
    <div *ngIf="loaded" class="fadeIn prediction">
        <!-- Prediction Time -->
        <div fxLayout="row" fxLayoutAlign="start center">
            <p class="light-text">Time</p>
            <span fxFlex></span>
            <p>{{prediction.t | date:'medium'}}</p>
        </div>

        <!-- Model Type -->
        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
            <p class="light-text">Model Type</p>
            <span fxFlex></span>
            <p class="clickable" (click)="_nav.displayModelDialog(model)">{{modelTypeName}}</p>
        </div>

        <!-- Metadata -->
        <div *ngFor="let md of metadata">
            <!-- Decision Model Metadata-->
            <div *ngIf="!md.priceChange">
                <!-- Description -->
                <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                    <p class="light-text">Description</p>
                    <span fxFlex></span>
                    <p>{{md.description}}</p>
                </div>

                <!-- Other decision properties @TODO-->
            </div>

            <!-- Single & Multi Model Metadata-->
            <div *ngIf="md.priceChange" class="margin-top">
                <!-- Heading -->
                <div fxLayout="row">
                    <!-- Description -->
                    <h5 class="truncate">{{md.description | uppercase}}</h5>

                    <span fxFlex></span>

                    <!-- RSI Badge -->
                    <div *ngIf="md.priceChange.rsi" [ngClass]="md.priceChange.rsi.badge" matTooltip="RSI: {{md.priceChange.rsi.value}}">
                        <mat-icon *ngIf="md.priceChange.rsi.result == 'overbought'">align_vertical_top</mat-icon>
                        <mat-icon *ngIf="md.priceChange.rsi.result == 'oversold'">align_vertical_bottom</mat-icon>
                        <mat-icon *ngIf="md.priceChange.rsi.result == 'neutral'">vertical_align_center</mat-icon>
                    </div>

                    <!-- EMA Badge -->
                    <div *ngIf="md.priceChange.ema" [ngClass]="md.priceChange.ema.badge" 
                        matTooltip="Short EMA: {{md.priceChange.ema.shortValue}} | Long EMA: {{md.priceChange.ema.longValue}} | Distance: {{md.priceChange.ema.distanceValue}}%">
                        <mat-icon *ngIf="md.priceChange.ema.result == 'upwards'">trending_up</mat-icon>
                        <mat-icon *ngIf="md.priceChange.ema.result == 'downwards'">trending_down</mat-icon>
                        <mat-icon *ngIf="md.priceChange.ema.result == 'sideways'">trending_flat</mat-icon>
                    </div>

                    <!-- Prediction Price Change Badge -->
                    <div [ngClass]="md.priceChange.change.badge" 
                        matTooltip="Price change between the first prediction and the last">
                        <span>{{md.priceChange.change.value}}%</span>
                    </div>
                </div>

                <!-- Price Prediction Chart -->
                <div>
                    <apx-chart
                        [series]="md.priceChange.change.chart.series"
                        [chart]="md.priceChange.change.chart.chart"
                        [xaxis]="md.priceChange.change.chart.xaxis"
                        [dataLabels]="md.priceChange.change.chart.dataLabels"
                        [grid]="md.priceChange.change.chart.grid"
                        [stroke]="md.priceChange.change.chart.stroke"
                        [tooltip]="{enabled: false}"
                    ></apx-chart>
                </div>
            </div>
        </div>
    </div>
</div>
