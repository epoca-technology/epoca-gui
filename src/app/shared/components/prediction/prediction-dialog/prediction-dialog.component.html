<mat-toolbar mat-dialog-title color="primary" fxLayout="row" fxLayoutAlign="start center">
    <div fxLayout="row" fxLayoutAlign="center center">
        <button mat-icon-button class="show-on-mobile" (click)="close()"><mat-icon>arrow_back</mat-icon></button>
        <span class="truncate">{{resultName}} Prediction</span>
        <span fxFlex></span>
        <button mat-icon-button class="show-on-desktop" (click)="close()"><mat-icon>close</mat-icon></button>
    </div>
</mat-toolbar>
<div mat-dialog-content>
    <!-- Loader -->
    <div *ngIf="!loaded">
        <div class="loader show-on-desktop"><div fxLayout="row" fxLayoutAlign="center center"><mat-spinner diameter="50"></mat-spinner></div></div>
        <div class="section-loader show-on-mobile"><div fxLayout="row" fxLayoutAlign="center center"><mat-spinner diameter="50"></mat-spinner></div></div>
    </div>

    <!-- Container -->
    <div *ngIf="loaded" class="fadeIn prediction">
        <!-- Prediction Time -->
        <div fxLayout="row" fxLayoutAlign="start center">
            <p class="light-text">Time</p>
            <span fxFlex></span>
            <p>{{prediction.t | date:'medium'}}</p>
        </div>

        <!-- Model Type -->
        <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
            <p class="light-text">Model Type</p>
            <span fxFlex></span>
            <p class="clickable" (click)="_nav.displayModelDialog(model)">{{modelTypeName}}</p>
        </div>

        <!-- Metadata -->
        <div *ngFor="let md of metadata; index as metdataIndex">

            <!-- Description -->
            <div class="margin-top" fxLayout="row" fxLayoutAlign="start center">
                <p *ngIf="!model.consensus_model" class="light-text">Description</p>
                <p *ngIf="model.consensus_model" class="light-text">{{model.consensus_model.sub_models[metdataIndex].id}}</p>
                <span fxFlex></span>
                <p>{{md.description}}</p>
            </div>


            <!-- Regression Models' Metadata-->
            <div *ngIf="md.priceChange" class="margin-top">
                <!-- Heading -->
                <div fxLayout="row" fxLayoutAlign="center start">
                    <!-- Description or ID -->
                    <p class="light-text">Predicted Trend</p>

                    <span fxFlex></span>

                    <!-- Prediction Price Change Badge -->
                    <div [ngClass]="md.priceChange.badge" 
                        matTooltip="Price change between the first prediction and the last">
                        <span>{{md.priceChange.value}}%</span>
                    </div>
                </div>

                <!-- Price Prediction Chart -->
                <div>
                    <apx-chart
                        [series]="md.priceChange.chart.series"
                        [chart]="md.priceChange.chart.chart"
                        [xaxis]="md.priceChange.chart.xaxis"
                        [yaxis]="md.priceChange.chart.yaxis"
                        [dataLabels]="md.priceChange.chart.dataLabels"
                        [grid]="md.priceChange.chart.grid"
                        [stroke]="md.priceChange.chart.stroke"
                        [tooltip]="{enabled: false}"
                    ></apx-chart>
                </div>
            </div>



            <!-- Classification Models' Metadata -->
            <div *ngIf="md.probabilities" class="margin-top">
                <!-- Heading -->
                <div fxLayout="row" fxLayoutAlign="center start">
                    <!-- Description or ID -->
                    <p class="light-text">Predicted Probabilities</p>

                    <span fxFlex></span>

                    <!-- Prediction Probabilities Badge -->
                    <div *ngIf="md.probabilities.result == 'long'" 
                        [ngClass]="md.probabilities.badge" 
                        matTooltip="Probability of a price increase.">
                        <mat-icon>trending_up</mat-icon> {{md.probabilities.upProbability}}%
                    </div>
                    <div *ngIf="md.probabilities.result == 'short'" 
                        [ngClass]="md.probabilities.badge" 
                        matTooltip="Probability of a price decrease.">
                        <mat-icon>trending_down</mat-icon> {{md.probabilities.downProbability}}%
                    </div>
                    <div *ngIf="md.probabilities.result == 'neutral'" 
                        [ngClass]="md.probabilities.badge" 
                        matTooltip="Probabilities of a price increase or decrease.">
                        <mat-icon>trending_flat</mat-icon> 50%
                    </div>
                </div>

                <!-- Probabilities Chart -->
                <!--<div class="probabilities mat-elevation-z2">
                    <div fxLayout="row" fxLayoutAlign="center center">
                        <div [fxFlex]="md.probabilities.upProbability" class="up-probability" matTooltip="Increase Probability">
                            {{md.probabilities.upProbability}}%
                        </div>
                        <div fxFlex class="down-probability" matTooltip="Decrease Probability">
                            {{md.probabilities.downProbability}}%
                        </div>
                    </div>
                </div>-->

                <!-- Features -->
                <div class="features">
                    <div *ngFor="let feature of md.probabilities.features" class="feature">
                        <!-- Regression Feature -->
                        <div *ngIf="feature.type == 'regression'" 
                        class="clickable" role="button"
                        (click)="_nav.displayModelDialog(feature.model)"
                        [matTooltip]="feature.model.id"
                        [ngClass]="{
                            'square-badge-success': feature.value > 0,
                            'square-badge-error': feature.value < 0,
                            'square-badge-neutral': feature.value == 0
                        }">
                            <mat-icon *ngIf="feature.value == 1">trending_up</mat-icon>
                            <mat-icon *ngIf="feature.value == -1">trending_down</mat-icon>
                            <mat-icon *ngIf="feature.value == 0">trending_flat</mat-icon>
                            &nbsp;{{feature.model.id | stringOverview: 10}}
                        </div>

                        <!-- TA Features -->
                        <div *ngIf="feature.type != 'regression'" 
                        [ngClass]="{
                            'square-badge-success': feature.value > 0,
                            'square-badge-error': feature.value < 0,
                            'square-badge-neutral': feature.value == 0
                        }">
                            <strong>{{feature.type | uppercase}}:</strong> {{feature.value}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
